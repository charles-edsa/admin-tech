<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Delivery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .hover-lift { transition: all 0.3s ease; }
        .hover-lift:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Barra de Menu Superior -->
    <nav class="bg-white border-b border-gray-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-2 sm:px-4 lg:px-8">
            <!-- Mobile Header -->
            <div class="flex justify-between items-center h-14 md:h-16">
                <h1 class="text-gray-800 text-lg md:text-xl font-semibold">
                    <i class="fas fa-store text-orange-500 mr-1 md:mr-2"></i>
                    <span class="hidden sm:inline">Painel Admin</span>
                    <span class="sm:hidden">Admin</span>
                </h1>
                
                <!-- Mobile Menu Button -->
                <button onclick="toggleMobileMenu()" class="md:hidden p-2 text-gray-600">
                    <i class="fas fa-bars text-lg"></i>
                </button>
                
                <!-- Desktop Navigation -->
                <div class="hidden md:block">
                    <nav class="flex space-x-8">
                        <button onclick="switchTab('pedidos')" id="tab-pedidos" class="tab-button text-orange-600 py-2 px-1 text-sm font-medium flex items-center border-b-2 border-orange-500">
                            <i class="fas fa-clipboard-list mr-2"></i>Pedidos
                        </button>
                        <button onclick="switchTab('salao')" id="tab-salao" class="tab-button text-gray-500 hover:text-gray-700 py-2 px-1 text-sm font-medium flex items-center border-b-2 border-transparent hover:border-gray-300">
                            <i class="fas fa-utensils mr-2"></i>Salão
                        </button>
                        <button onclick="switchTab('kds')" id="tab-kds" class="tab-button text-gray-500 hover:text-gray-700 py-2 px-1 text-sm font-medium flex items-center border-b-2 border-transparent hover:border-gray-300">
                            <i class="fas fa-tv mr-2"></i>Painel KDS
                        </button>
                        <button onclick="switchTab('entregas')" id="tab-entregas" class="tab-button text-gray-500 hover:text-gray-700 py-2 px-1 text-sm font-medium flex items-center border-b-2 border-transparent hover:border-gray-300">
                            <i class="fas fa-truck mr-2"></i>Entregas
                        </button>
                        <button onclick="switchTab('catalogo')" id="tab-catalogo" class="tab-button text-gray-500 hover:text-gray-700 py-2 px-1 text-sm font-medium flex items-center border-b-2 border-transparent hover:border-gray-300">
                            <i class="fas fa-book mr-2"></i>Catálogo
                        </button>
                        <button onclick="switchTab('configuracoes')" id="tab-configuracoes" class="tab-button text-gray-500 hover:text-gray-700 py-2 px-1 text-sm font-medium flex items-center border-b-2 border-transparent hover:border-gray-300">
                            <i class="fas fa-cog mr-2"></i>Configurações
                        </button>
                    </nav>
                </div>
            </div>
            

            
            <!-- Mobile Navigation -->
            <div id="mobile-menu" class="md:hidden hidden bg-white border-t border-gray-200 py-2">
                <div class="grid grid-cols-2 gap-2 px-2">
                    <button onclick="switchTab('pedidos'); toggleMobileMenu();" id="mobile-tab-pedidos" class="mobile-tab-button bg-orange-100 text-orange-700 p-3 rounded-lg text-sm font-medium flex flex-col items-center">
                        <i class="fas fa-clipboard-list text-lg mb-1"></i>
                        <span>Pedidos</span>
                    </button>
                    <button onclick="switchTab('salao'); toggleMobileMenu();" id="mobile-tab-salao" class="mobile-tab-button bg-gray-100 text-gray-600 p-3 rounded-lg text-sm font-medium flex flex-col items-center">
                        <i class="fas fa-utensils text-lg mb-1"></i>
                        <span>Salão</span>
                    </button>
                    <button onclick="switchTab('kds'); toggleMobileMenu();" id="mobile-tab-kds" class="mobile-tab-button bg-gray-100 text-gray-600 p-3 rounded-lg text-sm font-medium flex flex-col items-center">
                        <i class="fas fa-tv text-lg mb-1"></i>
                        <span>KDS</span>
                    </button>
                    <button onclick="switchTab('entregas'); toggleMobileMenu();" id="mobile-tab-entregas" class="mobile-tab-button bg-gray-100 text-gray-600 p-3 rounded-lg text-sm font-medium flex flex-col items-center">
                        <i class="fas fa-truck text-lg mb-1"></i>
                        <span>Entregas</span>
                    </button>
                    <button onclick="switchTab('catalogo'); toggleMobileMenu();" id="mobile-tab-catalogo" class="mobile-tab-button bg-gray-100 text-gray-600 p-3 rounded-lg text-sm font-medium flex flex-col items-center">
                        <i class="fas fa-book text-lg mb-1"></i>
                        <span>Catálogo</span>
                    </button>
                    <button onclick="switchTab('configuracoes'); toggleMobileMenu();" id="mobile-tab-configuracoes" class="mobile-tab-button bg-gray-100 text-gray-600 p-3 rounded-lg text-sm font-medium flex flex-col items-center">
                        <i class="fas fa-cog text-lg mb-1"></i>
                        <span>Config</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <div class="max-w-7xl mx-auto py-3 px-2 sm:py-6 sm:px-6 lg:px-8">

        <!-- Conteúdo da Aba Pedidos -->
        <div id="content-pedidos" class="tab-content">
            <!-- Mobile Layout -->
            <div class="block md:hidden space-y-4">
                <!-- Aguardando Mobile -->
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm">
                    <div class="bg-amber-50 border-b border-amber-200 px-3 py-3">
                        <div class="flex items-center justify-between">
                            <h3 class="text-sm font-semibold text-amber-700 uppercase tracking-wide">
                                <i class="fas fa-clock text-amber-500 mr-1"></i>Aguardando
                            </h3>
                            <span id="contador-aguardando-mobile" class="bg-amber-100 text-amber-700 text-xs font-medium px-2 py-1 rounded">3</span>
                        </div>
                    </div>
                    <div id="coluna-aguardando-mobile" class="p-3">
                        <!-- Conteúdo será inserido dinamicamente -->
                    </div>
                </div>

                <!-- Prontos Mobile -->
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm">
                    <div class="bg-green-50 border-b border-green-200 px-3 py-3">
                        <div class="flex items-center justify-between">
                            <h3 class="text-sm font-semibold text-green-700 uppercase tracking-wide">
                                <i class="fas fa-check-circle text-green-500 mr-1"></i>Prontos
                            </h3>
                            <span id="contador-prontos-mobile" class="bg-green-100 text-green-700 text-xs font-medium px-2 py-1 rounded">2</span>
                        </div>
                    </div>
                    <div id="coluna-prontos-mobile" class="p-3">
                        <!-- Conteúdo será inserido dinamicamente -->
                    </div>
                </div>
            </div>

            <!-- Desktop Layout -->
            <div id="pedidos-panel" class="hidden md:block">
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm">
                    <!-- Cabeçalho das Colunas -->
                    <div class="grid grid-cols-2 bg-gray-50 border-b border-gray-200">
                        <div class="px-6 py-4 border-r border-gray-200">
                            <div class="flex items-center justify-between">
                                <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide">
                                    <i class="fas fa-clock text-amber-500 mr-2"></i>Aguardando
                                </h3>
                                <span id="contador-aguardando" class="bg-amber-100 text-amber-700 text-xs font-medium px-2 py-1 rounded">3</span>
                            </div>
                        </div>
                        <div class="px-6 py-4">
                            <div class="flex items-center justify-between">
                                <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide">
                                    <i class="fas fa-check-circle text-green-500 mr-2"></i>Prontos
                                </h3>
                                <span id="contador-prontos" class="bg-green-100 text-green-700 text-xs font-medium px-2 py-1 rounded">2</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Conteúdo das Colunas -->
                    <div class="grid grid-cols-2 min-h-96">
                        <!-- Coluna Aguardando -->
                        <div id="coluna-aguardando" class="border-r border-gray-200 bg-white">
                            <!-- Conteúdo será inserido dinamicamente -->
                        </div>

                        <!-- Coluna Prontos -->
                        <div id="coluna-prontos" class="bg-white">
                            <!-- Conteúdo será inserido dinamicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Conteúdo da Aba Salão -->
        <div id="content-salao" class="tab-content hidden">
            <!-- Cabeçalho Mobile/Desktop -->
            <div class="mb-4 md:mb-6">
                <!-- Mobile Layout -->
                <div class="block md:hidden space-y-3">
                    <button onclick="openPDVModal()" class="w-full bg-green-500 text-white px-4 py-3 rounded-lg hover:bg-green-600 transition-colors font-medium shadow-sm text-center">
                        <i class="fas fa-cash-register mr-2"></i>Nova Venda
                    </button>
                    
                    <div class="flex bg-gray-100 rounded-lg p-1">
                        <button onclick="switchSalaoView('mesas')" id="view-mesas" class="salao-view-toggle flex-1 px-3 py-2 text-sm font-medium rounded-md transition-all duration-200 bg-white text-gray-900 shadow-sm text-center">
                            <i class="fas fa-chair mr-1"></i>Mesas
                        </button>
                        <button onclick="switchSalaoView('comandas')" id="view-comandas" class="salao-view-toggle flex-1 px-3 py-2 text-sm font-medium rounded-md transition-all duration-200 text-gray-500 hover:text-gray-700 text-center">
                            <i class="fas fa-receipt mr-1"></i>Comandas
                        </button>
                    </div>
                </div>
                
                <!-- Desktop Layout -->
                <div class="hidden md:flex items-center justify-between">
                    <div>
                        <button onclick="openPDVModal()" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors font-medium shadow-sm">
                            <i class="fas fa-cash-register mr-2"></i>Venda
                        </button>
                    </div>
                    
                    <div class="flex bg-gray-100 rounded-lg p-1">
                        <button onclick="switchSalaoView('mesas')" id="view-mesas-desktop" class="salao-view-toggle px-4 py-2 text-sm font-medium rounded-md transition-all duration-200 bg-white text-gray-900 shadow-sm">
                            <i class="fas fa-chair mr-2"></i>Mesas
                        </button>
                        <button onclick="switchSalaoView('comandas')" id="view-comandas-desktop" class="salao-view-toggle px-4 py-2 text-sm font-medium rounded-md transition-all duration-200 text-gray-500 hover:text-gray-700">
                            <i class="fas fa-receipt mr-2"></i>Comandas
                        </button>
                    </div>
                </div>
            </div>

            <!-- Painel Mesas -->
            <div id="mesas-panel" class="salao-panel">
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm">
                    <div class="bg-gray-50 border-b border-gray-200">
                        <div class="px-3 py-3 md:px-6 md:py-4">
                            <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide">
                                <i class="fas fa-chair text-orange-500 mr-2"></i>Mesas do Salão
                            </h3>
                        </div>
                    </div>
                    
                    <div class="p-3 md:p-6">
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4" id="mesas-grid">
                            <!-- Mesas serão inseridas dinamicamente -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Painel Comandas -->
            <div id="comandas-panel" class="salao-panel hidden">
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm">
                    <div class="bg-gray-50 border-b border-gray-200">
                        <div class="px-3 py-3 md:px-6 md:py-4">
                            <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide">
                                <i class="fas fa-receipt text-orange-500 mr-2"></i>Comandas Ativas
                            </h3>
                        </div>
                    </div>
                    
                    <div class="p-3 md:p-6">
                        <div class="space-y-3 md:space-y-4" id="comandas-grid">
                            <!-- Comandas serão inseridas dinamicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Conteúdo da Aba KDS -->
        <div id="content-kds" class="tab-content hidden">
            <!-- Mobile KDS Layout -->
            <div class="block md:hidden space-y-4">
                <!-- Novos Pedidos Mobile -->
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm">
                    <div class="bg-orange-50 border-b border-orange-200 px-3 py-3">
                        <div class="flex items-center justify-between">
                            <h3 class="text-sm font-semibold text-orange-700 uppercase tracking-wide">
                                <i class="fas fa-bell text-orange-500 mr-1"></i>Novos Pedidos
                            </h3>
                            <span id="contador-novos-kds-mobile" class="bg-orange-100 text-orange-700 text-xs font-medium px-2 py-1 rounded">3</span>
                        </div>
                    </div>
                    <div id="coluna-novos-kds-mobile" class="p-3">
                        <!-- Conteúdo será inserido dinamicamente -->
                    </div>
                </div>

                <!-- Em Preparação Mobile -->
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm">
                    <div class="bg-blue-50 border-b border-blue-200 px-3 py-3">
                        <div class="flex items-center justify-between">
                            <h3 class="text-sm font-semibold text-blue-700 uppercase tracking-wide">
                                <i class="fas fa-utensils text-blue-500 mr-1"></i>Em Preparação
                            </h3>
                            <span id="contador-preparo-kds-mobile" class="bg-blue-100 text-blue-700 text-xs font-medium px-2 py-1 rounded">2</span>
                        </div>
                    </div>
                    <div id="coluna-preparo-kds-mobile" class="p-3">
                        <!-- Conteúdo será inserido dinamicamente -->
                    </div>
                </div>
            </div>

            <!-- Desktop KDS Layout -->
            <div id="delivery-panel-kds" class="hidden md:block pedidos-panel">
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm">
                    <!-- Cabeçalho das Colunas -->
                    <div class="grid grid-cols-2 bg-gray-50 border-b border-gray-200">
                        <div class="px-6 py-4 border-r border-gray-200">
                            <div class="flex items-center justify-between">
                                <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide">
                                    <i class="fas fa-bell text-orange-500 mr-2"></i>Novos Pedidos
                                </h3>
                                <span id="contador-novos-kds" class="bg-orange-100 text-orange-700 text-xs font-medium px-2 py-1 rounded">3</span>
                            </div>
                        </div>
                        <div class="px-6 py-4">
                            <div class="flex items-center justify-between">
                                <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide">
                                    <i class="fas fa-utensils text-blue-500 mr-2"></i>Em Preparação
                                </h3>
                                <span id="contador-preparo-kds" class="bg-blue-100 text-blue-700 text-xs font-medium px-2 py-1 rounded">2</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Conteúdo das Colunas -->
                    <div class="grid grid-cols-2 min-h-96">
                        <!-- Coluna Novos -->
                        <div id="coluna-novos-kds" class="border-r border-gray-200 bg-white">
                            <!-- Conteúdo será inserido dinamicamente -->
                        </div>

                        <!-- Coluna Preparando -->
                        <div id="coluna-preparo-kds" class="bg-white">
                            <!-- Conteúdo será inserido dinamicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Conteúdo da Aba Entregas -->
        <div id="content-entregas" class="tab-content hidden">
            <div class="bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm">
                <div class="bg-gray-50 border-b border-gray-200 px-3 py-3 md:px-6 md:py-4">
                    <div class="flex items-center justify-between">
                        <h3 class="text-base md:text-lg font-semibold text-gray-900">
                            <i class="fas fa-truck text-blue-500 mr-1 md:mr-2"></i>Entregas Ativas
                        </h3>
                        <span id="contador-entregas" class="bg-blue-100 text-blue-700 text-xs md:text-sm font-medium px-2 md:px-3 py-1 rounded">2 entregas</span>
                    </div>
                </div>
                
                <div class="p-3 md:p-6">
                    <div id="pedidos-entregas" class="space-y-3 md:space-y-4">
                        <!-- Entregas serão inseridas dinamicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Conteúdo da Aba Catálogo -->
        <div id="content-catalogo" class="tab-content hidden">
            <div class="bg-white rounded-lg border border-gray-200 p-4 md:p-8">
                <div class="text-center text-gray-500">
                    <i class="fas fa-book text-3xl md:text-4xl mb-3 md:mb-4"></i>
                    <h3 class="text-base md:text-lg font-medium text-gray-900 mb-2">Catálogo de Produtos</h3>
                    <p class="text-sm">Esta seção estará disponível em breve.</p>
                </div>
            </div>
        </div>

        <!-- Conteúdo da Aba Configurações -->
        <div id="content-configuracoes" class="tab-content hidden">
            <div class="bg-white rounded-lg border border-gray-200 p-4 md:p-8">
                <div class="text-center text-gray-500">
                    <i class="fas fa-cog text-3xl md:text-4xl mb-3 md:mb-4"></i>
                    <h3 class="text-base md:text-lg font-medium text-gray-900 mb-2">Configurações do Sistema</h3>
                    <p class="text-sm">Esta seção estará disponível em breve.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal da Mesa -->
    <div id="mesa-modal" class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 hidden p-2 md:p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg max-h-[90vh] md:max-h-[85vh] flex flex-col mx-2 md:mx-0">
            <div class="flex items-center justify-between p-3 md:p-4 border-b border-gray-100 flex-shrink-0">
                <div class="flex items-center space-x-2">
                    <h3 class="text-base md:text-lg font-semibold text-gray-900">Mesa <span id="mesa-number">1</span></h3>
                    <span id="mesa-status" class="text-xs font-medium px-2 py-1 rounded bg-green-100 text-green-700">Livre</span>
                </div>
                <button onclick="closeMesaModal()" class="text-gray-400 hover:text-gray-600 transition-colors p-1">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            
            <div id="mesa-content" class="flex-1 overflow-y-auto p-3 md:p-4">
                <!-- Conteúdo dinâmico será inserido aqui -->
            </div>
        </div>
    </div>

    <!-- Modal PDV -->
    <div id="pdv-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-2 md:p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-7xl max-h-[95vh] md:max-h-[90vh] flex flex-col">
            <!-- Header Mobile/Desktop -->
            <div class="flex items-center justify-between p-3 md:p-4 border-b border-gray-200 flex-shrink-0">
                <!-- Mobile Categories (Horizontal Scroll) -->
                <div class="flex items-center space-x-2 overflow-x-auto scrollbar-hide md:space-x-2">
                    <button onclick="filterCategory('todos')" class="category-filter active px-3 py-2 text-xs md:text-sm font-medium rounded-lg bg-orange-100 text-orange-700 whitespace-nowrap">
                        Todos
                    </button>
                    <button onclick="filterCategory('lanches')" class="category-filter px-3 py-2 text-xs md:text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 whitespace-nowrap">
                        Lanches
                    </button>
                    <button onclick="filterCategory('bebidas')" class="category-filter px-3 py-2 text-xs md:text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 whitespace-nowrap">
                        Bebidas
                    </button>
                    <button onclick="filterCategory('porcoes')" class="category-filter px-3 py-2 text-xs md:text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 whitespace-nowrap">
                        Porções
                    </button>
                    <button onclick="filterCategory('sobremesas')" class="category-filter px-3 py-2 text-xs md:text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 whitespace-nowrap">
                        Sobremesas
                    </button>
                </div>
                <button onclick="closePDVModal()" class="text-gray-400 hover:text-gray-600 transition-colors ml-2 md:ml-4 p-1">
                    <i class="fas fa-times text-lg md:text-xl"></i>
                </button>
            </div>
            
            <div class="flex-1 overflow-hidden">
                <!-- Mobile Layout (Stack) -->
                <div class="block lg:hidden h-full">
                    <!-- Mobile Toggle -->
                    <div class="flex bg-gray-100 rounded-lg p-1 m-3">
                        <button onclick="togglePDVMobileView('produtos')" id="pdv-mobile-produtos" class="pdv-mobile-toggle flex-1 px-3 py-2 text-sm font-medium rounded-md transition-all duration-200 bg-white text-gray-900 shadow-sm text-center">
                            <i class="fas fa-th-large mr-1"></i>Produtos
                        </button>
                        <button onclick="togglePDVMobileView('carrinho')" id="pdv-mobile-carrinho" class="pdv-mobile-toggle flex-1 px-3 py-2 text-sm font-medium rounded-md transition-all duration-200 text-gray-500 hover:text-gray-700 text-center">
                            <i class="fas fa-shopping-cart mr-1"></i>Carrinho <span id="cart-count-mobile" class="bg-orange-500 text-white text-xs px-1 rounded-full ml-1 hidden">0</span>
                        </button>
                    </div>
                    
                    <!-- Mobile Produtos Panel -->
                    <div id="pdv-mobile-produtos-panel" class="pdv-mobile-panel flex-1 overflow-y-auto px-3 pb-3">
                        <div class="grid grid-cols-2 gap-3" id="produtos-grid-mobile">
                            <!-- Produtos serão inseridos aqui via JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Mobile Carrinho Panel -->
                    <div id="pdv-mobile-carrinho-panel" class="pdv-mobile-panel hidden flex-1 overflow-hidden flex flex-col px-3 pb-3">
                        <!-- Seleção de Destino Mobile -->
                        <div class="mb-4 flex-shrink-0">
                            <h4 class="text-sm font-medium text-gray-900 mb-3">Destino da Venda</h4>
                            <div class="space-y-2">
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="setDestinoVenda('balcao')" id="destino-balcao-mobile" class="destino-toggle-mobile px-3 py-2 text-xs font-medium rounded-lg border border-gray-300 bg-white text-gray-900">
                                        <i class="fas fa-store mr-1"></i>Balcão
                                    </button>
                                    <button onclick="setDestinoVenda('mesa')" id="destino-mesa-mobile" class="destino-toggle-mobile px-3 py-2 text-xs font-medium rounded-lg border border-gray-300 text-gray-500">
                                        <i class="fas fa-chair mr-1"></i>Mesa
                                    </button>
                                </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="setDestinoVenda('comanda')" id="destino-comanda-mobile" class="destino-toggle-mobile px-3 py-2 text-xs font-medium rounded-lg border border-gray-300 text-gray-500">
                                        <i class="fas fa-receipt mr-1"></i>Comanda
                                    </button>
                                    <button onclick="setDestinoVenda('delivery')" id="destino-delivery-mobile" class="destino-toggle-mobile px-3 py-2 text-xs font-medium rounded-lg border border-gray-300 text-gray-500">
                                        <i class="fas fa-motorcycle mr-1"></i>Delivery
                                    </button>
                                </div>
                            </div>
                            
                            <div id="destino-especifico-mobile" class="mt-3 hidden">
                                <select id="select-destino-mobile" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                    <option value="">Selecione...</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Itens do Carrinho Mobile -->
                        <div class="flex-1 overflow-hidden flex flex-col">
                            <div class="flex items-center justify-between mb-3 flex-shrink-0">
                                <h4 class="text-sm font-medium text-gray-900">Itens</h4>
                                <button onclick="clearCart()" class="text-xs text-red-500 hover:text-red-700">
                                    <i class="fas fa-trash mr-1"></i>Limpar
                                </button>
                            </div>
                            
                            <div id="cart-items-mobile" class="space-y-2 flex-1 overflow-y-auto mb-4">
                                <div class="text-center py-8 text-gray-400">
                                    <i class="fas fa-shopping-cart text-2xl mb-2"></i>
                                    <p class="text-sm">Nenhum item selecionado</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Forma de Pagamento Mobile -->
                        <div class="mb-4 flex-shrink-0">
                            <h4 class="text-sm font-medium text-gray-900 mb-3">Pagamento</h4>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="setFormaPagamento('dinheiro')" id="pagamento-dinheiro-mobile" class="pagamento-toggle-mobile px-3 py-2 text-xs font-medium rounded-lg border border-gray-300 text-gray-700">
                                    <i class="fas fa-money-bill mr-1"></i>Dinheiro
                                </button>
                                <button onclick="setFormaPagamento('cartao')" id="pagamento-cartao-mobile" class="pagamento-toggle-mobile px-3 py-2 text-xs font-medium rounded-lg border border-gray-300 text-gray-700">
                                    <i class="fas fa-credit-card mr-1"></i>Cartão
                                </button>
                                <button onclick="setFormaPagamento('pix')" id="pagamento-pix-mobile" class="pagamento-toggle-mobile px-3 py-2 text-xs font-medium rounded-lg border border-gray-300 text-gray-700">
                                    <i class="fas fa-qrcode mr-1"></i>PIX
                                </button>
                                <button onclick="setFormaPagamento('fiado')" id="pagamento-fiado-mobile" class="pagamento-toggle-mobile px-3 py-2 text-xs font-medium rounded-lg border border-gray-300 text-gray-700">
                                    <i class="fas fa-handshake mr-1"></i>Fiado
                                </button>
                            </div>
                        </div>
                        
                        <!-- Resumo e Finalização Mobile -->
                        <div class="flex-shrink-0">
                            <div class="bg-gray-50 rounded-lg p-3 mb-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm text-gray-600">Subtotal</span>
                                    <span id="cart-subtotal-mobile" class="text-sm font-medium text-gray-900">R$ 0,00</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-xs text-gray-500">Taxa (10%)</span>
                                    <span id="cart-taxa-mobile" class="text-xs text-gray-500">R$ 0,00</span>
                                </div>
                                <div class="border-t border-gray-200 pt-2">
                                    <div class="flex justify-between items-center">
                                        <span class="font-semibold text-gray-900">Total</span>
                                        <span id="cart-total-mobile" class="font-bold text-lg text-gray-900">R$ 0,00</span>
                                    </div>
                                </div>
                            </div>
                            
                            <button onclick="finalizarVenda()" id="btn-finalizar-venda-mobile" class="w-full bg-green-500 text-white py-3 px-4 rounded-lg font-medium hover:bg-green-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed" disabled>
                                <i class="fas fa-check mr-2"></i>Finalizar Venda
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Desktop Layout (Side by Side) -->
                <div class="hidden lg:grid lg:grid-cols-3 h-full">
                    <!-- Painel de Produtos -->
                    <div class="lg:col-span-2 border-r border-gray-200 flex flex-col">
                        <div class="flex-1 overflow-y-auto p-4">
                            <div class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4" id="produtos-grid">
                                <!-- Produtos serão inseridos aqui via JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Painel do Carrinho -->
                    <div class="lg:col-span-1 flex flex-col">
                        <!-- Seleção de Destino -->
                        <div class="p-4 border-b border-gray-200 flex-shrink-0">
                            <h4 class="text-sm font-medium text-gray-900 mb-3">Destino da Venda</h4>
                            <div class="space-y-2">
                                <div class="flex bg-gray-100 rounded-lg p-1">
                                    <button onclick="setDestinoVenda('balcao')" id="destino-balcao" class="destino-toggle flex-1 px-3 py-2 text-xs font-medium rounded-md transition-all duration-200 bg-white text-gray-900 shadow-sm">
                                        <i class="fas fa-store mr-1"></i>Balcão
                                    </button>
                                    <button onclick="setDestinoVenda('mesa')" id="destino-mesa" class="destino-toggle flex-1 px-3 py-2 text-xs font-medium rounded-md transition-all duration-200 text-gray-500 hover:text-gray-700">
                                        <i class="fas fa-chair mr-1"></i>Mesa
                                    </button>
                                </div>
                                <div class="flex bg-gray-100 rounded-lg p-1">
                                    <button onclick="setDestinoVenda('comanda')" id="destino-comanda" class="destino-toggle flex-1 px-3 py-2 text-xs font-medium rounded-md transition-all duration-200 text-gray-500 hover:text-gray-700">
                                        <i class="fas fa-receipt mr-1"></i>Comanda
                                    </button>
                                    <button onclick="setDestinoVenda('delivery')" id="destino-delivery" class="destino-toggle flex-1 px-3 py-2 text-xs font-medium rounded-md transition-all duration-200 text-gray-500 hover:text-gray-700">
                                        <i class="fas fa-motorcycle mr-1"></i>Delivery
                                    </button>
                                </div>
                            </div>
                            
                            <div id="destino-especifico" class="mt-3 hidden">
                                <select id="select-destino" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                    <option value="">Selecione...</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Itens do Carrinho -->
                        <div class="flex-1 overflow-hidden p-4 flex flex-col">
                            <div class="flex items-center justify-between mb-4 flex-shrink-0">
                                <h4 class="text-sm font-medium text-gray-900">Itens Selecionados</h4>
                                <button onclick="clearCart()" class="text-xs text-red-500 hover:text-red-700">
                                    <i class="fas fa-trash mr-1"></i>Limpar
                                </button>
                            </div>
                            
                            <div id="cart-items" class="space-y-3 flex-1 overflow-y-auto">
                                <div class="text-center py-8 text-gray-400">
                                    <i class="fas fa-shopping-cart text-2xl mb-2"></i>
                                    <p class="text-sm">Nenhum item selecionado</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Forma de Pagamento -->
                        <div class="p-4 border-t border-gray-200 flex-shrink-0">
                            <h4 class="text-sm font-medium text-gray-900 mb-3">Forma de Pagamento</h4>
                            <div class="grid grid-cols-2 gap-2 mb-4">
                                <button onclick="setFormaPagamento('dinheiro')" id="pagamento-dinheiro" class="pagamento-toggle px-3 py-2 text-xs font-medium rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors">
                                    <i class="fas fa-money-bill mr-1"></i>Dinheiro
                                </button>
                                <button onclick="setFormaPagamento('cartao')" id="pagamento-cartao" class="pagamento-toggle px-3 py-2 text-xs font-medium rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors">
                                    <i class="fas fa-credit-card mr-1"></i>Cartão
                                </button>
                                <button onclick="setFormaPagamento('pix')" id="pagamento-pix" class="pagamento-toggle px-3 py-2 text-xs font-medium rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors">
                                    <i class="fas fa-qrcode mr-1"></i>PIX
                                </button>
                                <button onclick="setFormaPagamento('fiado')" id="pagamento-fiado" class="pagamento-toggle px-3 py-2 text-xs font-medium rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors">
                                    <i class="fas fa-handshake mr-1"></i>Fiado
                                </button>
                            </div>
                        </div>
                        
                        <!-- Resumo e Finalização -->
                        <div class="p-4 border-t border-gray-200 flex-shrink-0">
                            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm text-gray-600">Subtotal</span>
                                    <span id="cart-subtotal" class="text-sm font-medium text-gray-900">R$ 0,00</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-xs text-gray-500">Taxa de serviço (10%)</span>
                                    <span id="cart-taxa" class="text-xs text-gray-500">R$ 0,00</span>
                                </div>
                                <div class="border-t border-gray-200 pt-2">
                                    <div class="flex justify-between items-center">
                                        <span class="font-semibold text-gray-900">Total</span>
                                        <span id="cart-total" class="font-bold text-lg text-gray-900">R$ 0,00</span>
                                    </div>
                                </div>
                            </div>
                            
                            <button onclick="finalizarVenda()" id="btn-finalizar-venda" class="w-full bg-green-500 text-white py-3 px-4 rounded-lg font-medium hover:bg-green-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed" disabled>
                                <i class="fas fa-check mr-2"></i>Finalizar Venda
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal do Pedido -->
    <div id="pedido-modal" class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 hidden p-2 md:p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg max-h-[90vh] md:max-h-[85vh] flex flex-col mx-2 md:mx-0">
            <div class="flex items-center justify-between p-3 md:p-4 border-b border-gray-100 flex-shrink-0">
                <div class="flex items-center space-x-2">
                    <h3 class="text-base md:text-lg font-semibold text-gray-900">Pedido <span id="pedido-number">#001</span></h3>
                </div>
                <button onclick="closePedidoModal()" class="text-gray-400 hover:text-gray-600 transition-colors p-1">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            
            <div id="pedido-content" class="flex-1 overflow-y-auto p-3 md:p-4">
                <!-- Conteúdo dinâmico será inserido aqui -->
            </div>
        </div>
    </div>

    <script>
        // Sistema de geração de IDs universais
        let contadorPedidos = {
            delivery: 1,    // D001, D002, D003...
            balcao: 1,      // B001, B002, B003...
            mesa: 1,        // M001, M002, M003...
            comanda: 1      // C001, C002, C003...
        };

        function gerarIdPedido(tipo, categoria = null) {
            let prefixo = '';
            let contador = 0;
            
            if (tipo === 'delivery') {
                prefixo = 'D';
                contador = contadorPedidos.delivery++;
            } else if (tipo === 'balcao') {
                prefixo = 'B';
                contador = contadorPedidos.balcao++;
            } else if (tipo === 'mesa') {
                prefixo = 'M';
                contador = contadorPedidos.mesa++;
            } else if (tipo === 'comanda') {
                prefixo = 'C';
                contador = contadorPedidos.comanda++;
            }
            
            return `${prefixo}${contador.toString().padStart(3, '0')}`;
        }

        // Estado global do sistema - Fluxo contínuo de pedidos
        let pedidosData = {
            novos: [
                { id: 'D001', cliente: 'João Silva', telefone: '(11) 99999-1234', total: 45.90, itens: ['2x Hambúrguer', '1x Batata Frita'], tempo: '5min', hora: '10:30', tipo: 'delivery', endereco: 'Rua das Flores, 123 - Centro', distancia: '1.2 km' },
                { id: 'B001', cliente: 'Maria Santos', telefone: '(11) 98888-5678', total: 32.00, itens: ['1x Pizza Margherita'], tempo: '2min', hora: '10:45', tipo: 'balcao' },
                { id: 'D002', cliente: 'Roberto Lima', telefone: '(11) 97777-9012', total: 18.50, itens: ['1x Açaí 500ml', '1x Vitamina'], tempo: '1min', hora: '11:05', tipo: 'delivery', endereco: 'Rua Augusta, 789 - Consolação', distancia: '0.8 km' }
            ],
            preparo: [
                { id: 'B002', cliente: 'Carlos Oliveira', telefone: '(11) 96666-3456', total: 28.50, itens: ['3x Pastel', '1x Refrigerante'], tempo: '25min', hora: '10:15', tipo: 'balcao' },
                { id: 'D003', cliente: 'Fernanda Costa', telefone: '(11) 95555-7890', total: 54.00, itens: ['2x Pizza Individual', '2x Refrigerante'], tempo: '15min', hora: '10:50', tipo: 'delivery', endereco: 'Rua Oscar Freire, 321 - Jardins', distancia: '3.5 km' }
            ]
        };

        // Pedidos na aba Pedidos - Nova estrutura
        let pedidosAbaData = {
            aguardando: [
                { id: 'D004', cliente: 'Lucas Pereira', telefone: '(11) 91234-5678', total: 38.50, itens: ['1x Pizza Calabresa', '1x Refrigerante'], tempo: '2min', hora: '11:25', tipo: 'delivery', endereco: 'Av. Brasil, 456 - Vila Nova', distancia: '2.3 km' },
                { id: 'B003', cliente: 'Carla Santos', telefone: '(11) 98765-4321', total: 24.90, itens: ['1x Hambúrguer', '1x Batata'], tempo: '1min', hora: '11:30', tipo: 'balcao' },
                { id: 'D005', cliente: 'Rafael Costa', telefone: '(11) 95555-1111', total: 42.00, itens: ['2x Sanduíche Natural', '2x Suco'], tempo: '3min', hora: '11:20', tipo: 'delivery', endereco: 'Rua das Palmeiras, 789 - Centro', distancia: '1.8 km' }
            ],
            prontos: [
                { id: 'D006', cliente: 'Amanda Silva', telefone: '(11) 92222-7777', total: 35.90, itens: ['1x Pizza Margherita', '1x Refrigerante'], tempo: '5min', hora: '10:45', tipo: 'delivery', endereco: 'Rua dos Jardins, 321 - Bela Vista', distancia: '2.1 km', entregador: null },
                { id: 'B004', cliente: 'Bruno Lima', telefone: '(11) 93333-8888', total: 28.50, itens: ['2x Hambúrguer'], tempo: '3min', hora: '10:50', tipo: 'balcao', entregador: null }
            ]
        };

        // Pedidos em entrega (aba Entregas)
        let pedidosEntregaData = [
            { 
                id: 'D007', 
                cliente: 'Pedro Santos', 
                telefone: '(11) 91111-2222', 
                total: 42.50, 
                itens: ['1x Pizza Calabresa', '1x Refrigerante'], 
                endereco: 'Av. Paulista, 1000 - Bela Vista',
                distancia: '2.1 km',
                entregador: 'Carlos Moto',
                tempoSaida: '10:45',
                previsaoEntrega: '11:15',
                status: 'saindo'
            },
            { 
                id: 'D008', 
                cliente: 'Ana Lima', 
                telefone: '(11) 92222-3333', 
                total: 28.90, 
                itens: ['2x Hambúrguer'], 
                endereco: 'Rua da Consolação, 500 - Centro',
                distancia: '1.8 km',
                entregador: 'João Bike',
                tempoSaida: '10:30',
                previsaoEntrega: '11:00',
                status: 'entregando'
            }
        ];



        let mesasData = {
            1: { status: 'livre', lugares: 4 },
            2: { 
                status: 'ocupada', 
                lugares: 4, 
                tempo: '45min',
                atendente: 'Carlos Silva',
                taxaGarcom: true,
                clientes: [
                    { id: 1, nome: 'João Santos', pedidos: ['Hambúrguer', 'Refrigerante'], total: 28.90, pago: false, taxaServico: true },
                    { id: 2, nome: 'Maria Santos', pedidos: ['Pizza Individual'], total: 22.00, pago: false, taxaServico: true }
                ]
            },
            3: { status: 'livre', lugares: 2 },
            4: { status: 'reservada', lugares: 6, cliente: 'João Silva', pessoas: 4, horario: '16:00' },
            5: { status: 'livre', lugares: 8 },
            6: { 
                status: 'ocupada', 
                lugares: 2, 
                tempo: '1h20min',
                atendente: 'Ana Costa',
                taxaGarcom: false,
                clientes: [
                    { id: 1, nome: 'Pedro Lima', pedidos: ['Sanduíche', 'Suco'], total: 22.90, pago: true, taxaServico: false }
                ]
            },
            7: { status: 'livre', lugares: 2 },
            8: { status: 'livre', lugares: 6 }
        };

        let comandasData = {
            'C001': { cliente: 'João Silva', total: 34.50, tempo: '25min', status: 'ativa', itens: 2 },
            'C002': { cliente: 'Maria Santos', total: 18.90, tempo: '12min', status: 'ativa', itens: 1 },
            'C003': { cliente: 'Carlos Lima', total: 67.20, tempo: 'Aguardando', status: 'pendente', itens: 4 },
            'C004': { cliente: 'Ana Costa', total: 45.30, tempo: '1h20min', status: 'ativa', itens: 3 }
        };

        // Atualizar contadores baseado nos dados existentes
        contadorPedidos.delivery = 9;  // Próximo será D009
        contadorPedidos.balcao = 5;    // Próximo será B005
        contadorPedidos.mesa = 1;      // Próximo será M001
        contadorPedidos.comanda = 5;   // Próximo será C005

        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('border-orange-500', 'text-orange-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            document.querySelectorAll('.mobile-tab-button').forEach(btn => {
                btn.classList.remove('bg-orange-100', 'text-orange-700');
                btn.classList.add('bg-gray-100', 'text-gray-600');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            const activeTab = document.getElementById(`tab-${tabName}`);
            if (activeTab) {
                activeTab.classList.add('border-orange-500', 'text-orange-600');
                activeTab.classList.remove('border-transparent', 'text-gray-500');
            }
            
            const activeMobileTab = document.getElementById(`mobile-tab-${tabName}`);
            if (activeMobileTab) {
                activeMobileTab.classList.add('bg-orange-100', 'text-orange-700');
                activeMobileTab.classList.remove('bg-gray-100', 'text-gray-600');
            }
            
            document.getElementById(`content-${tabName}`).classList.remove('hidden');
        }



        // Atualização dinâmica dos pedidos no KDS
        function atualizarPainelKDS() {
            const colunas = {
                novos: document.getElementById('coluna-novos-kds'),
                preparo: document.getElementById('coluna-preparo-kds')
            };

            const colunasMobile = {
                novos: document.getElementById('coluna-novos-kds-mobile'),
                preparo: document.getElementById('coluna-preparo-kds-mobile')
            };

            // Atualizar contadores desktop
            const contadorNovos = document.getElementById('contador-novos-kds');
            const contadorPreparo = document.getElementById('contador-preparo-kds');
            
            if (contadorNovos) contadorNovos.textContent = pedidosData.novos.length;
            if (contadorPreparo) contadorPreparo.textContent = pedidosData.preparo.length;

            // Atualizar contadores mobile
            const contadorNovosMobile = document.getElementById('contador-novos-kds-mobile');
            const contadorPreparoMobile = document.getElementById('contador-preparo-kds-mobile');
            
            if (contadorNovosMobile) contadorNovosMobile.textContent = pedidosData.novos.length;
            if (contadorPreparoMobile) contadorPreparoMobile.textContent = pedidosData.preparo.length;

            // Renderizar pedidos desktop e mobile
            Object.keys(colunas).forEach(status => {
                const coluna = colunas[status];
                const colunaMobile = colunasMobile[status];
                const pedidos = pedidosData[status];
                
                const emptyContent = `
                    <div class="p-6 text-center text-gray-400">
                        <i class="fas fa-${status === 'novos' ? 'bell' : 'utensils'} text-2xl mb-2"></i>
                        <p class="text-sm">Nenhum pedido</p>
                    </div>
                `;

                const emptyContentMobile = `
                    <div class="text-center py-6 text-gray-400">
                        <i class="fas fa-${status === 'novos' ? 'bell' : 'utensils'} text-xl mb-2"></i>
                        <p class="text-sm">Nenhum pedido</p>
                    </div>
                `;
                
                if (pedidos.length === 0) {
                    if (coluna) coluna.innerHTML = emptyContent;
                    if (colunaMobile) colunaMobile.innerHTML = emptyContentMobile;
                    return;
                }
                
                const pedidosHTML = pedidos.map((pedido, index) => `
                    <div class="px-4 py-4 ${index > 0 ? 'border-t border-gray-200' : ''}">
                        <div class="hover:bg-${status === 'novos' ? 'gray' : 'blue'}-50 transition-colors cursor-pointer rounded-lg p-3" onclick="openPedidoModal('${pedido.id}', '${status}')">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm font-semibold text-gray-900">#${pedido.id}</span>
                                    ${pedido.tipo ? `<span class="text-xs px-2 py-1 rounded-full ${pedido.tipo === 'delivery' ? 'bg-blue-100 text-blue-700' : 'bg-orange-100 text-orange-700'}">
                                        <i class="fas fa-${pedido.tipo === 'delivery' ? 'motorcycle' : 'store'} mr-1"></i>${pedido.tipo === 'delivery' ? 'Delivery' : 'Balcão'}
                                    </span>` : ''}
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-gray-500">${pedido.hora}</div>
                                    <div class="text-xs text-${status === 'novos' ? 'orange' : 'blue'}-600 font-medium">${pedido.tempo}</div>
                                </div>
                            </div>
                            <p class="text-sm text-gray-700 font-medium mb-1">${pedido.cliente}</p>
                            <p class="text-xs text-gray-600 mb-2">${pedido.itens.join(', ')}</p>
                            ${pedido.endereco && pedido.tipo === 'delivery' ? `
                                <div class="flex items-center text-xs text-gray-500 mb-3">
                                    <i class="fas fa-map-marker-alt mr-1"></i>
                                    <span class="truncate">${pedido.endereco}</span>
                                    ${pedido.distancia ? `<span class="ml-2 text-blue-600">${pedido.distancia}</span>` : ''}
                                </div>
                            ` : '<div class="mb-1"></div>'}
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-bold text-gray-900">R$ ${pedido.total.toFixed(2)}</span>
                                <button onclick="event.stopPropagation(); ${status === 'novos' ? 'aceitarPedido' : 'finalizarPedido'}('${pedido.id}')" class="text-xs bg-${status === 'novos' ? 'blue' : 'green'}-500 text-white px-3 py-1 rounded hover:bg-${status === 'novos' ? 'blue' : 'green'}-600 transition-colors">
                                    ${status === 'novos' ? 'Preparar' : 'Finalizar'}
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');

                const pedidosMobileHTML = pedidos.map(pedido => `
                    <div class="bg-white border border-gray-200 rounded-lg p-3 mb-3 cursor-pointer hover:bg-gray-50" onclick="openPedidoModal('${pedido.id}', '${status}')">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center space-x-2">
                                <span class="text-sm font-semibold text-gray-900">#${pedido.id}</span>
                                ${pedido.tipo ? `<span class="text-xs px-2 py-1 rounded-full ${pedido.tipo === 'delivery' ? 'bg-blue-100 text-blue-700' : 'bg-orange-100 text-orange-700'}">
                                    <i class="fas fa-${pedido.tipo === 'delivery' ? 'motorcycle' : 'store'} mr-1"></i>${pedido.tipo === 'delivery' ? 'Delivery' : 'Balcão'}
                                </span>` : ''}
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-gray-500">${pedido.hora}</div>
                                <div class="text-xs text-${status === 'novos' ? 'orange' : 'blue'}-600 font-medium">${pedido.tempo}</div>
                            </div>
                        </div>
                        <p class="text-sm text-gray-700 font-medium mb-1">${pedido.cliente}</p>
                        <p class="text-xs text-gray-600 mb-2">${pedido.itens.join(', ')}</p>
                        ${pedido.endereco && pedido.tipo === 'delivery' ? `
                            <div class="flex items-center text-xs text-gray-500 mb-3">
                                <i class="fas fa-map-marker-alt mr-1"></i>
                                <span class="truncate">${pedido.endereco}</span>
                                ${pedido.distancia ? `<span class="ml-2 text-blue-600">${pedido.distancia}</span>` : ''}
                            </div>
                        ` : '<div class="mb-1"></div>'}
                        <div class="flex justify-between items-center">
                            <span class="text-sm font-bold text-gray-900">R$ ${pedido.total.toFixed(2)}</span>
                            <button onclick="event.stopPropagation(); ${status === 'novos' ? 'aceitarPedido' : 'finalizarPedido'}('${pedido.id}')" class="text-xs bg-${status === 'novos' ? 'blue' : 'green'}-500 text-white px-3 py-1 rounded hover:bg-${status === 'novos' ? 'blue' : 'green'}-600 transition-colors">
                                ${status === 'novos' ? 'Preparar' : 'Finalizar'}
                            </button>
                        </div>
                    </div>
                `).join('');
                
                if (coluna) coluna.innerHTML = pedidosHTML;
                if (colunaMobile) colunaMobile.innerHTML = pedidosMobileHTML;
            });
        }

        // Atualização dinâmica da nova aba Pedidos
        function atualizarPainelPedidos() {
            const colunas = {
                aguardando: document.getElementById('coluna-aguardando'),
                prontos: document.getElementById('coluna-prontos')
            };

            const colunasMobile = {
                aguardando: document.getElementById('coluna-aguardando-mobile'),
                prontos: document.getElementById('coluna-prontos-mobile')
            };

            // Atualizar contadores desktop
            const contadorAguardando = document.getElementById('contador-aguardando');
            const contadorProntos = document.getElementById('contador-prontos');
            
            if (contadorAguardando) contadorAguardando.textContent = pedidosAbaData.aguardando.length;
            if (contadorProntos) contadorProntos.textContent = pedidosAbaData.prontos.length;

            // Atualizar contadores mobile
            const contadorAguardandoMobile = document.getElementById('contador-aguardando-mobile');
            const contadorProntosMobile = document.getElementById('contador-prontos-mobile');
            
            if (contadorAguardandoMobile) contadorAguardandoMobile.textContent = pedidosAbaData.aguardando.length;
            if (contadorProntosMobile) contadorProntosMobile.textContent = pedidosAbaData.prontos.length;

            // Renderizar pedidos desktop e mobile
            Object.keys(colunas).forEach(status => {
                const coluna = colunas[status];
                const colunaMobile = colunasMobile[status];
                const pedidos = pedidosAbaData[status];
                
                const emptyContent = `
                    <div class="p-6 text-center text-gray-400">
                        <i class="fas fa-${status === 'aguardando' ? 'clock' : 'check-circle'} text-2xl mb-2"></i>
                        <p class="text-sm">Nenhum pedido</p>
                    </div>
                `;

                const emptyContentMobile = `
                    <div class="text-center py-6 text-gray-400">
                        <i class="fas fa-${status === 'aguardando' ? 'clock' : 'check-circle'} text-xl mb-2"></i>
                        <p class="text-sm">Nenhum pedido</p>
                    </div>
                `;
                
                if (pedidos.length === 0) {
                    if (coluna) coluna.innerHTML = emptyContent;
                    if (colunaMobile) colunaMobile.innerHTML = emptyContentMobile;
                    return;
                }
                
                const pedidosHTML = pedidos.map((pedido, index) => `
                    <div class="px-4 py-4 ${index > 0 ? 'border-t border-gray-200' : ''}">
                        <div class="hover:bg-${status === 'aguardando' ? 'amber' : 'green'}-50 transition-colors cursor-pointer rounded-lg p-3" onclick="openPedidoAbaModal('${pedido.id}', '${status}')">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm font-semibold text-gray-900">#${pedido.id}</span>
                                    ${pedido.tipo ? `<span class="text-xs px-2 py-1 rounded-full ${pedido.tipo === 'delivery' ? 'bg-blue-100 text-blue-700' : 'bg-orange-100 text-orange-700'}">
                                        <i class="fas fa-${pedido.tipo === 'delivery' ? 'motorcycle' : 'store'} mr-1"></i>${pedido.tipo === 'delivery' ? 'Delivery' : 'Balcão'}
                                    </span>` : ''}
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-gray-500">${pedido.hora}</div>
                                    <div class="text-xs text-${status === 'aguardando' ? 'amber' : 'green'}-600 font-medium">${pedido.tempo}</div>
                                </div>
                            </div>
                            <p class="text-sm text-gray-700 font-medium mb-1">${pedido.cliente}</p>
                            <p class="text-xs text-gray-600 mb-2">${pedido.itens.join(', ')}</p>
                            ${pedido.endereco && pedido.tipo === 'delivery' ? `
                                <div class="flex items-center text-xs text-gray-500 mb-3">
                                    <i class="fas fa-map-marker-alt mr-1"></i>
                                    <span class="truncate">${pedido.endereco}</span>
                                    ${pedido.distancia ? `<span class="ml-2 text-blue-600">${pedido.distancia}</span>` : ''}
                                </div>
                            ` : '<div class="mb-1"></div>'}
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-bold text-gray-900">R$ ${pedido.total.toFixed(2)}</span>
                                ${status === 'aguardando' ? 
                                    `<button onclick="event.stopPropagation(); aceitarPedidoAba('${pedido.id}')" class="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition-colors">
                                        Aceitar
                                    </button>` :
                                    pedido.tipo === 'delivery' ?
                                        `<button onclick="event.stopPropagation(); designarEntregador('${pedido.id}')" class="text-xs bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition-colors">
                                            Designar
                                        </button>` :
                                        `<button onclick="event.stopPropagation(); entregarPedidoPronto('${pedido.id}')" class="text-xs bg-orange-500 text-white px-3 py-1 rounded hover:bg-orange-600 transition-colors">
                                            Entregar
                                        </button>`
                                }
                            </div>
                        </div>
                    </div>
                `).join('');

                const pedidosMobileHTML = pedidos.map(pedido => `
                    <div class="bg-white border border-gray-200 rounded-lg p-3 mb-3 cursor-pointer hover:bg-gray-50" onclick="openPedidoAbaModal('${pedido.id}', '${status}')">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center space-x-2">
                                <span class="text-sm font-semibold text-gray-900">#${pedido.id}</span>
                                ${pedido.tipo ? `<span class="text-xs px-2 py-1 rounded-full ${pedido.tipo === 'delivery' ? 'bg-blue-100 text-blue-700' : 'bg-orange-100 text-orange-700'}">
                                    <i class="fas fa-${pedido.tipo === 'delivery' ? 'motorcycle' : 'store'} mr-1"></i>${pedido.tipo === 'delivery' ? 'Delivery' : 'Balcão'}
                                </span>` : ''}
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-gray-500">${pedido.hora}</div>
                                <div class="text-xs text-${status === 'aguardando' ? 'amber' : 'green'}-600 font-medium">${pedido.tempo}</div>
                            </div>
                        </div>
                        <p class="text-sm text-gray-700 font-medium mb-1">${pedido.cliente}</p>
                        <p class="text-xs text-gray-600 mb-2">${pedido.itens.join(', ')}</p>
                        ${pedido.endereco && pedido.tipo === 'delivery' ? `
                            <div class="flex items-center text-xs text-gray-500 mb-3">
                                <i class="fas fa-map-marker-alt mr-1"></i>
                                <span class="truncate">${pedido.endereco}</span>
                                ${pedido.distancia ? `<span class="ml-2 text-blue-600">${pedido.distancia}</span>` : ''}
                            </div>
                        ` : '<div class="mb-1"></div>'}
                        <div class="flex justify-between items-center">
                            <span class="text-sm font-bold text-gray-900">R$ ${pedido.total.toFixed(2)}</span>
                            ${status === 'aguardando' ? 
                                `<button onclick="event.stopPropagation(); aceitarPedidoAba('${pedido.id}')" class="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition-colors">
                                    Aceitar
                                </button>` :
                                pedido.tipo === 'delivery' ?
                                    `<button onclick="event.stopPropagation(); designarEntregador('${pedido.id}')" class="text-xs bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition-colors">
                                        Designar
                                    </button>` :
                                    `<button onclick="event.stopPropagation(); entregarPedidoPronto('${pedido.id}')" class="text-xs bg-orange-500 text-white px-3 py-1 rounded hover:bg-orange-600 transition-colors">
                                        Entregar
                                    </button>`
                            }
                        </div>
                    </div>
                `).join('');
                
                if (coluna) coluna.innerHTML = pedidosHTML;
                if (colunaMobile) colunaMobile.innerHTML = pedidosMobileHTML;
            });
        }

        // Atualização dinâmica dos pedidos em Entrega
        function atualizarPainelEntregas() {
            const container = document.getElementById('pedidos-entregas');
            const contador = document.getElementById('contador-entregas');
            
            // Atualizar contador
            contador.textContent = `${pedidosEntregaData.length} ${pedidosEntregaData.length === 1 ? 'entrega' : 'entregas'}`;
            
            if (pedidosEntregaData.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        <i class="fas fa-truck text-3xl mb-3"></i>
                        <p class="text-sm">Nenhuma entrega ativa</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = pedidosEntregaData.map((pedido, index) => {
                const statusColors = {
                    'saindo': { bg: 'amber', text: 'Saindo para entrega' },
                    'entregando': { bg: 'blue', text: 'Em rota de entrega' },
                    'entregue': { bg: 'green', text: 'Entregue' }
                };
                const statusInfo = statusColors[pedido.status] || statusColors['saindo'];
                
                return `
                    <div class="${index > 0 ? 'border-t border-gray-200 pt-3 md:pt-4' : ''}">
                        <div class="hover:bg-gray-50 transition-colors cursor-pointer rounded-lg p-3" onclick="openPedidoEntregaModal('${pedido.id}')">
                            <!-- Mobile Layout -->
                            <div class="block md:hidden">
                                <div class="flex justify-between items-start mb-2">
                                    <span class="text-sm font-semibold text-gray-900">#${pedido.id}</span>
                                    <div class="text-right">
                                        <div class="text-xs text-gray-500">Saiu: ${pedido.tempoSaida}</div>
                                        <div class="text-xs text-${statusInfo.bg}-600 font-medium">${statusInfo.text}</div>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-700 font-medium mb-1">${pedido.cliente}</p>
                                <p class="text-xs text-gray-600 mb-2">${pedido.itens.join(', ')}</p>
                                <div class="flex items-center text-xs text-gray-500 mb-2">
                                    <i class="fas fa-map-marker-alt mr-1"></i>
                                    <span class="truncate">${pedido.endereco}</span>
                                    <span class="ml-2 text-blue-600">${pedido.distancia}</span>
                                </div>
                                <div class="flex items-center text-xs text-gray-500 mb-3">
                                    <i class="fas fa-motorcycle mr-1"></i>
                                    <span>${pedido.entregador}</span>
                                    <span class="ml-2">• Previsão: ${pedido.previsaoEntrega}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-bold text-gray-900">R$ ${pedido.total.toFixed(2)}</span>
                                    ${pedido.status !== 'entregue' ? `
                                        <button onclick="event.stopPropagation(); confirmarEntrega('${pedido.id}')" class="text-xs bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition-colors">
                                            Confirmar
                                        </button>
                                    ` : `
                                        <span class="text-xs bg-green-100 text-green-700 px-3 py-1 rounded font-medium">
                                            Entregue
                                        </span>
                                    `}
                                </div>
                            </div>
                            
                            <!-- Desktop Layout -->
                            <div class="hidden md:block">
                                <div class="flex justify-between items-start mb-2">
                                    <span class="text-sm font-semibold text-gray-900">#${pedido.id}</span>
                                    <div class="text-right">
                                        <div class="text-xs text-gray-500">Saiu: ${pedido.tempoSaida}</div>
                                        <div class="text-xs text-${statusInfo.bg}-600 font-medium">${statusInfo.text}</div>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-700 font-medium mb-1">${pedido.cliente}</p>
                                <p class="text-xs text-gray-600 mb-2">${pedido.itens.join(', ')}</p>
                                <div class="flex items-center text-xs text-gray-500 mb-2">
                                    <i class="fas fa-map-marker-alt mr-1"></i>
                                    <span class="truncate">${pedido.endereco}</span>
                                    <span class="ml-2 text-blue-600">${pedido.distancia}</span>
                                </div>
                                <div class="flex items-center text-xs text-gray-500 mb-3">
                                    <i class="fas fa-motorcycle mr-1"></i>
                                    <span>${pedido.entregador}</span>
                                    <span class="ml-2">• Previsão: ${pedido.previsaoEntrega}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-bold text-gray-900">R$ ${pedido.total.toFixed(2)}</span>
                                    ${pedido.status !== 'entregue' ? `
                                        <button onclick="event.stopPropagation(); confirmarEntrega('${pedido.id}')" class="text-xs bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition-colors">
                                            Confirmar
                                        </button>
                                    ` : `
                                        <span class="text-xs bg-green-100 text-green-700 px-3 py-1 rounded font-medium">
                                            Entregue
                                        </span>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }



        // Controle da visualização do Salão
        function switchSalaoView(view) {
            document.querySelectorAll('.salao-view-toggle').forEach(btn => {
                btn.classList.remove('bg-white', 'text-gray-900', 'shadow-sm');
                btn.classList.add('text-gray-500');
            });
            
            // Update both mobile and desktop toggles
            const mobileToggle = document.getElementById(`view-${view}`);
            const desktopToggle = document.getElementById(`view-${view}-desktop`);
            
            if (mobileToggle) {
                mobileToggle.classList.add('bg-white', 'text-gray-900', 'shadow-sm');
                mobileToggle.classList.remove('text-gray-500');
            }
            
            if (desktopToggle) {
                desktopToggle.classList.add('bg-white', 'text-gray-900', 'shadow-sm');
                desktopToggle.classList.remove('text-gray-500');
            }
            
            document.querySelectorAll('.salao-panel').forEach(panel => {
                panel.classList.add('hidden');
            });
            
            document.getElementById(`${view}-panel`).classList.remove('hidden');
        }

        // Atualização dinâmica das mesas
        function atualizarPainelMesas() {
            const mesasContainer = document.getElementById('mesas-grid');
            
            mesasContainer.innerHTML = Object.keys(mesasData).map((numero) => {
                const mesa = mesasData[numero];
                const statusColors = {
                    livre: { bg: 'green', icon: 'chair' },
                    ocupada: { bg: 'red', icon: 'users' },
                    reservada: { bg: 'amber', icon: 'clock' }
                };
                const color = statusColors[mesa.status];
                
                return `
                    <div onclick="openMesaModal(${numero}, '${mesa.status}')" class="bg-white border border-gray-200 rounded-lg p-4 hover:border-gray-300 hover:shadow-sm transition-all cursor-pointer">
                        <div class="text-center">
                            <div class="w-12 h-12 bg-${color.bg}-100 rounded-lg flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-${color.icon} text-${color.bg}-600 text-lg"></i>
                            </div>
                            <h4 class="text-sm font-semibold text-gray-900 mb-1">Mesa ${numero.toString().padStart(2, '0')}</h4>
                            <div class="text-xs text-gray-500 mb-2">
                                ${mesa.status === 'ocupada' ? `${mesa.clientes ? mesa.clientes.length : 0}/${mesa.lugares} pessoas` : mesa.status === 'reservada' ? `${mesa.pessoas} pessoas` : `${mesa.lugares} lugares`}
                            </div>
                            <div class="flex items-center justify-center space-x-1 mb-2">
                                <div class="w-2 h-2 bg-${color.bg}-500 rounded-full"></div>
                                <span class="text-xs text-gray-600">${mesa.status.charAt(0).toUpperCase() + mesa.status.slice(1)}</span>
                            </div>
                            ${mesa.tempo || mesa.horario ? `<div class="text-xs text-${color.bg}-600 font-medium">${mesa.tempo || mesa.horario}</div>` : ''}
                            ${mesa.atendente ? `<div class="text-xs text-gray-500 mt-1">${mesa.atendente}</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Atualização dinâmica das comandas
        function atualizarPainelComandas() {
            const comandasContainer = document.getElementById('comandas-grid');
            const comandasAtivas = Object.keys(comandasData).filter(id => comandasData[id].status === 'ativa' || comandasData[id].status === 'pendente');
            
            if (comandasContainer) {
                comandasContainer.innerHTML = comandasAtivas.map((id, index) => {
                    const comanda = comandasData[id];
                    const color = comanda.status === 'ativa' ? 'blue' : 'amber';
                    
                    return `
                        <div class="${index > 0 ? 'border-t border-gray-200 pt-3 md:pt-4' : ''}">
                            <div onclick="openComandaAvulsaModal('${id}', '${comanda.status}')" class="hover:bg-gray-50 transition-colors cursor-pointer rounded-lg p-3">
                                <div class="flex justify-between items-start mb-2">
                                    <span class="text-sm font-semibold text-gray-900">#${id}</span>
                                    <div class="text-right">
                                        <div class="text-xs text-gray-500">${comanda.cliente}</div>
                                        <div class="text-xs text-${color}-600 font-medium">${comanda.tempo}</div>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-${color}-500 rounded-full"></div>
                                        <span class="text-xs text-gray-600">${comanda.status === 'ativa' ? 'Ativa' : 'Pendente'}</span>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm font-bold text-gray-900">R$ ${comanda.total.toFixed(2)}</div>
                                        <div class="text-xs text-gray-500">${comanda.itens} ${comanda.itens === 1 ? 'item' : 'itens'}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Modal da Mesa
        function openMesaModal(numero, status) {
            const modal = document.getElementById('mesa-modal');
            const mesaNumber = document.getElementById('mesa-number');
            const mesaStatus = document.getElementById('mesa-status');
            const mesaContent = document.getElementById('mesa-content');
            
            mesaNumber.textContent = numero;
            mesaStatus.style.display = 'none'; // Ocultar o status do cabeçalho
            
            if (status === 'livre') {
                mesaContent.innerHTML = `
                    <div class="space-y-6">
                        <div class="flex items-center justify-between py-3 border-b border-gray-100">
                            <span class="text-sm font-medium text-green-700">Livre</span>
                            <span class="text-sm text-gray-500">-</span>
                        </div>
                        
                        <div class="text-center py-4">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-chair text-green-600 text-xl"></i>
                            </div>
                            <p class="text-sm text-gray-600">Mesa disponível para ocupação</p>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-700">Lugares</span>
                                <div class="flex items-center space-x-3">
                                    <button onclick="adjustLugares(${numero}, -1)" class="w-8 h-8 bg-white border border-gray-300 rounded-full hover:bg-gray-50 transition-colors flex items-center justify-center">
                                        <i class="fas fa-minus text-xs text-gray-600"></i>
                                    </button>
                                    <span id="lugares-${numero}" class="text-sm font-medium text-gray-900 w-6 text-center">${mesasData[numero].lugares}</span>
                                    <button onclick="adjustLugares(${numero}, 1)" class="w-8 h-8 bg-white border border-gray-300 rounded-full hover:bg-gray-50 transition-colors flex items-center justify-center">
                                        <i class="fas fa-plus text-xs text-gray-600"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="reservarMesa(${numero})" class="flex-1 bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors">
                                Reservar
                            </button>
                            <button onclick="ocuparMesa(${numero})" class="flex-1 bg-green-500 text-white py-3 px-4 rounded-lg text-sm font-medium hover:bg-green-600 transition-colors">
                                Ocupar
                            </button>
                        </div>
                    </div>
                `;
            } else if (status === 'ocupada') {
                const mesa = mesasData[numero];
                const totalMesa = mesa.clientes ? mesa.clientes.reduce((sum, cliente) => sum + cliente.total, 0) : 0;
                const totalComTaxa = mesa.taxaGarcom ? totalMesa * 1.1 : totalMesa;
                
                mesaContent.innerHTML = `
                    <div class="space-y-4">
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-700">Status:</span>
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm font-medium text-red-700">Ocupada</span>
                                    <span class="text-sm text-gray-500">${mesa.tempo}</span>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-700">Atendente:</span>
                                <button onclick="trocarAtendente(${numero})" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                                    ${mesa.atendente || 'Definir'}
                                </button>
                            </div>
                        </div>
                        
                        <div class="border-t border-gray-200 pt-4">
                            <div class="flex items-center justify-between mb-4">
                                <span class="text-sm font-medium text-gray-900">Clientes (${mesa.clientes ? mesa.clientes.length : 0}/${mesa.lugares})</span>
                                <button onclick="adicionarCliente(${numero})" class="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">
                                    Adicionar
                                </button>
                            </div>
                            
                            <div class="space-y-4">
                                ${mesa.clientes ? mesa.clientes.map((cliente, index) => `
                                    <div class="${index > 0 ? 'border-t border-gray-200 pt-4' : ''}">
                                        <div class="flex items-center justify-between mb-3">
                                            <span class="text-sm font-medium text-gray-900">${cliente.nome}</span>
                                            <span class="text-xs px-2 py-1 rounded ${cliente.pago ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700'}">
                                                ${cliente.pago ? 'Pago' : 'Pendente'}
                                            </span>
                                        </div>
                                        
                                        <div class="space-y-2 mb-3">
                                            ${cliente.pedidos && cliente.pedidos.length > 0 ? cliente.pedidos.map(pedido => {
                                                // Simular dados de produtos com detalhes
                                                const produtos = [
                                                    { nome: 'Hambúrguer', preco: 22.90, quantidade: 1, detalhes: 'Sem cebola, extra bacon' },
                                                    { nome: 'Refrigerante', preco: 6.00, quantidade: 1, detalhes: null },
                                                    { nome: 'Pizza Individual', preco: 22.00, quantidade: 1, detalhes: 'Borda recheada, extra queijo' },
                                                    { nome: 'Sanduíche', preco: 14.90, quantidade: 1, detalhes: 'Sem maionese' },
                                                    { nome: 'Suco', preco: 8.00, quantidade: 1, detalhes: null },
                                                    { nome: 'Batata Frita', preco: 12.50, quantidade: 1, detalhes: null }
                                                ];
                                                const produto = produtos.find(p => pedido.includes(p.nome)) || { nome: pedido, preco: 15.00, quantidade: 1, detalhes: null };
                                                
                                                return `
                                                    <div class="text-xs text-gray-700">
                                                        <div>${produto.quantidade} • ${produto.nome} • R$ ${produto.preco.toFixed(2)}</div>
                                                        ${produto.detalhes ? `<div class="text-xs text-gray-500 ml-3 mt-1">${produto.detalhes}</div>` : ''}
                                                    </div>
                                                `;
                                            }).join('') : '<div class="text-xs text-gray-500 italic">Nenhum pedido</div>'}
                                        </div>
                                        
                                        <div class="flex items-center justify-between mb-3">
                                            <span class="text-xs text-gray-600">Taxa de serviço (10%)</span>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" ${cliente.taxaServico !== false ? 'checked' : ''} onchange="toggleTaxaCliente(${numero}, ${cliente.id})" class="sr-only peer">
                                                <div class="w-7 h-4 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[1px] after:left-[1px] after:bg-white after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-blue-600"></div>
                                            </label>
                                        </div>
                                        
                                        <div class="flex items-center justify-between">
                                            <div class="text-sm">
                                                <span class="text-gray-600">Subtotal: </span>
                                                <span class="font-medium text-gray-900">R$ ${cliente.total.toFixed(2)}</span>
                                                ${cliente.taxaServico !== false ? `<span class="text-xs text-gray-500 ml-1">(+10%: R$ ${(cliente.total * 1.1).toFixed(2)})</span>` : ''}
                                            </div>
                                            ${!cliente.pago ? `
                                                <div class="relative">
                                                    <button onclick="togglePagamentoMenu(${numero}, ${cliente.id})" id="btn-pagar-${numero}-${cliente.id}" class="text-xs bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition-colors">
                                                        Pagar
                                                    </button>
                                                    <div id="menu-pagamento-${numero}-${cliente.id}" class="hidden absolute right-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-10 min-w-32">
                                                        <button onclick="processarPagamento(${numero}, ${cliente.id}, 'pix')" class="w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 rounded-t-lg">
                                                            <i class="fas fa-qrcode mr-2"></i>PIX
                                                        </button>
                                                        <button onclick="processarPagamento(${numero}, ${cliente.id}, 'dinheiro')" class="w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50">
                                                            <i class="fas fa-money-bill mr-2"></i>Dinheiro
                                                        </button>
                                                        <button onclick="processarPagamento(${numero}, ${cliente.id}, 'cartao')" class="w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50">
                                                            <i class="fas fa-credit-card mr-2"></i>Cartão
                                                        </button>
                                                        <button onclick="processarPagamento(${numero}, ${cliente.id}, 'online')" class="w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 rounded-b-lg">
                                                            <i class="fas fa-globe mr-2"></i>Online
                                                        </button>
                                                    </div>
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `).join('') : '<div class="text-center py-4 text-gray-500 text-sm">Nenhum cliente</div>'}
                            </div>
                        </div>
                        
                        <div class="border-t border-gray-200 pt-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm text-gray-600">Subtotal da Mesa</span>
                                <span class="text-sm text-gray-900">R$ ${totalMesa.toFixed(2)}</span>
                            </div>
                            ${mesa.clientes && mesa.clientes.some(c => c.taxaServico !== false) ? `
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-xs text-gray-500">Taxa de serviço (10%)</span>
                                    <span class="text-xs text-gray-500">R$ ${(mesa.clientes.reduce((sum, c) => sum + (c.taxaServico !== false ? c.total * 0.1 : 0), 0)).toFixed(2)}</span>
                                </div>
                            ` : ''}
                            <div class="border-t border-gray-200 pt-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-900">Total da Mesa</span>
                                    <span class="text-lg font-bold text-orange-500">R$ ${(mesa.clientes ? mesa.clientes.reduce((sum, c) => sum + (c.taxaServico !== false ? c.total * 1.1 : c.total), 0) : 0).toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="border-t border-gray-200 pt-4">
                            <div class="flex space-x-3">
                                <button onclick="editarMesa(${numero})" class="w-24 bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg text-sm font-medium hover:bg-gray-50">
                                    Editar
                                </button>
                                <button onclick="finalizarAtendimento(${numero})" class="flex-1 bg-green-500 text-white py-3 px-4 rounded-lg text-sm font-medium hover:bg-green-600">
                                    Finalizar Atendimento
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else if (status === 'reservada') {
                const mesa = mesasData[numero];
                mesaContent.innerHTML = `
                    <div class="space-y-6">
                        <div class="flex items-center justify-between py-3 border-b border-gray-100">
                            <span class="text-sm font-medium text-amber-700">Reservada</span>
                            <span class="text-sm text-gray-500">${mesa.horario}</span>
                        </div>
                        
                        <div class="text-center py-4">
                            <div class="w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-clock text-amber-600 text-xl"></i>
                            </div>
                            <p class="text-sm text-gray-600">Aguardando chegada</p>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-4 space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-700">Cliente</span>
                                <span class="text-sm font-medium text-gray-900">${mesa.cliente}</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-700">Pessoas</span>
                                <span class="text-sm font-medium text-gray-900">${mesa.pessoas}</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-700">Lugares</span>
                                <span class="text-sm font-medium text-gray-900">${mesa.lugares}</span>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="cancelarReserva(${numero})" class="flex-1 bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg text-sm font-medium hover:bg-gray-50">
                                Cancelar
                            </button>
                            <button onclick="confirmarChegada(${numero})" class="flex-1 bg-green-500 text-white py-3 px-4 rounded-lg text-sm font-medium hover:bg-green-600">
                                Confirmar Chegada
                            </button>
                        </div>
                    </div>
                `;
            }
            
            modal.classList.remove('hidden');
        }
        
        function closeMesaModal() {
            document.getElementById('mesa-modal').classList.add('hidden');
        }





        // Modal do Pedido de Entrega
        function openPedidoEntregaModal(numero) {
            const modal = document.getElementById('pedido-modal');
            const pedidoNumber = document.getElementById('pedido-number');
            const pedidoContent = document.getElementById('pedido-content');
            
            pedidoNumber.textContent = numero;
            
            const pedido = pedidosEntregaData.find(p => p.id === numero);
            if (!pedido) return;
            
            const telefoneFormatado = pedido.telefone.replace(/\D/g, '');
            const statusColors = {
                'saindo': { bg: 'amber', text: 'Saindo para entrega' },
                'entregando': { bg: 'blue', text: 'Em rota de entrega' },
                'entregue': { bg: 'green', text: 'Entregue' }
            };
            const statusInfo = statusColors[pedido.status] || statusColors['saindo'];
            
            pedidoContent.innerHTML = `
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-medium text-gray-900">${pedido.cliente}</span>
                            <span class="text-gray-400">•</span>
                            <button onclick="window.open('https://wa.me/55${telefoneFormatado}', '_blank')" class="text-sm text-green-600 hover:text-green-800 transition-colors">
                                ${pedido.telefone}
                            </button>
                        </div>
                        <span class="text-xs px-2 py-1 rounded-full bg-${statusInfo.bg}-100 text-${statusInfo.bg}-700">
                            ${statusInfo.text}
                        </span>
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="space-y-3">
                            ${pedido.itens.map(item => `
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <div class="text-sm text-gray-900">${item}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-900">Total</span>
                            <span class="text-sm font-bold text-orange-500">R$ ${pedido.total.toFixed(2)}</span>
                        </div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="space-y-3">
                            <div>
                                <span class="text-sm font-medium text-gray-900 block mb-1">Endereço de Entrega</span>
                                <button onclick="window.open('https://maps.google.com/?q=${encodeURIComponent(pedido.endereco)}', '_blank')" class="text-sm text-blue-600 hover:text-blue-800 transition-colors text-left">
                                    <i class="fas fa-map-marker-alt mr-1"></i>${pedido.endereco}
                                </button>
                                <div class="text-xs text-gray-500 mt-1">
                                    <i class="fas fa-route mr-1"></i>Distância: ${pedido.distancia}
                                </div>
                            </div>
                            
                            <div>
                                <span class="text-sm font-medium text-gray-900 block mb-1">Informações da Entrega</span>
                                <div class="text-sm text-gray-700 space-y-1">
                                    <div><i class="fas fa-motorcycle mr-2 text-blue-500"></i>Entregador: ${pedido.entregador}</div>
                                    <div><i class="fas fa-clock mr-2 text-gray-500"></i>Saiu às: ${pedido.tempoSaida}</div>
                                    <div><i class="fas fa-calendar-check mr-2 text-green-500"></i>Previsão: ${pedido.previsaoEntrega}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="flex space-x-3">
                            ${pedido.status !== 'entregue' ? `
                                <button onclick="confirmarEntrega('${numero}'); closePedidoModal();" class="flex-1 bg-green-500 text-white py-2 px-4 rounded font-medium hover:bg-green-600 transition-colors">
                                    <i class="fas fa-check mr-2"></i>Confirmar
                                </button>
                            ` : `
                                <button onclick="finalizarEntrega('${numero}'); closePedidoModal();" class="flex-1 bg-blue-500 text-white py-2 px-4 rounded font-medium hover:bg-blue-600 transition-colors">
                                    <i class="fas fa-archive mr-2"></i>Arquivar Entrega
                                </button>
                            `}
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // Função para confirmar entrega
        function confirmarEntrega(numero) {
            const pedidoIndex = pedidosEntregaData.findIndex(p => p.id === numero);
            if (pedidoIndex !== -1) {
                pedidosEntregaData[pedidoIndex].status = 'entregue';
                atualizarPainelEntregas();
                showNotification(`Entrega ${numero} confirmada!`, 'success');
            }
        }

        // Função para finalizar/arquivar entrega
        function finalizarEntrega(numero) {
            const pedidoIndex = pedidosEntregaData.findIndex(p => p.id === numero);
            if (pedidoIndex !== -1) {
                pedidosEntregaData.splice(pedidoIndex, 1);
                atualizarPainelEntregas();
                showNotification(`Entrega ${numero} arquivada!`, 'success');
            }
        }



        // Modal do Pedido
        function openPedidoModal(numero, status) {
            const modal = document.getElementById('pedido-modal');
            const pedidoNumber = document.getElementById('pedido-number');
            const pedidoContent = document.getElementById('pedido-content');
            
            pedidoNumber.textContent = numero;
            
            // Buscar pedido nos dados do KDS
            let pedido = null;
            let pedidoStatus = status;
            
            if (pedidosData.novos.find(p => p.id === numero)) {
                pedido = pedidosData.novos.find(p => p.id === numero);
                pedidoStatus = 'novos';
            } else if (pedidosData.preparo.find(p => p.id === numero)) {
                pedido = pedidosData.preparo.find(p => p.id === numero);
                pedidoStatus = 'preparo';
            }
            
            if (!pedido) return;
            
            let botoes = '';
            if (pedidoStatus === 'novos') {
                botoes = `
                    <button onclick="rejeitarPedido('${numero}')" class="w-20 border border-gray-300 text-gray-700 py-2 px-3 rounded text-sm font-medium hover:bg-gray-50 transition-colors">
                        Rejeitar
                    </button>
                    <button onclick="aceitarPedido('${numero}')" class="flex-1 bg-blue-500 text-white py-2 px-4 rounded font-medium hover:bg-blue-600 transition-colors">
                        Preparar
                    </button>
                `;
            } else if (pedidoStatus === 'preparo') {
                botoes = `
                    <button onclick="voltarNovos('${numero}')" class="w-20 border border-gray-300 text-gray-700 py-2 px-3 rounded text-sm font-medium hover:bg-gray-50 transition-colors">
                        Voltar
                    </button>
                    <button onclick="finalizarPedido('${numero}')" class="flex-1 bg-green-500 text-white py-2 px-4 rounded font-medium hover:bg-green-600 transition-colors">
                        Finalizar
                    </button>
                `;
            }
            
            const telefoneFormatado = pedido.telefone.replace(/\D/g, '');
            
            pedidoContent.innerHTML = `
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-medium text-gray-900">${pedido.cliente}</span>
                            <span class="text-gray-400">•</span>
                            <button onclick="window.open('https://wa.me/55${telefoneFormatado}', '_blank')" class="text-sm text-green-600 hover:text-green-800 transition-colors">
                                ${pedido.telefone}
                            </button>
                        </div>
                        ${pedido.tipo ? `<span class="text-xs px-2 py-1 rounded-full ${pedido.tipo === 'delivery' ? 'bg-blue-100 text-blue-700' : 'bg-orange-100 text-orange-700'}">
                            <i class="fas fa-${pedido.tipo === 'delivery' ? 'motorcycle' : 'store'} mr-1"></i>${pedido.tipo === 'delivery' ? 'Delivery' : 'Balcão'}
                        </span>` : ''}
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="space-y-3">
                            ${pedido.itens.map(item => `
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <div class="text-sm text-gray-900">${item}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-900">Total</span>
                            <span class="text-sm font-bold text-orange-500">R$ ${pedido.total.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600">Forma de Pagamento</span>
                            <span class="text-xs font-medium text-gray-700">
                                ${pedido.tipo === 'delivery' ? 'PIX automático' : 'Cartão'}
                            </span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Status do Pagamento</span>
                            <span class="text-xs font-medium px-2 py-1 rounded bg-green-100 text-green-700">
                                Confirmado
                            </span>
                        </div>
                    </div>
                    
                    ${pedido.endereco && pedido.tipo === 'delivery' ? `
                        <div class="border-t pt-4">
                            <div class="space-y-2">
                                <div>
                                    <span class="text-sm font-medium text-gray-900 block mb-1">Endereço de Entrega</span>
                                    <button onclick="window.open('https://maps.google.com/?q=${encodeURIComponent(pedido.endereco)}', '_blank')" class="text-sm text-blue-600 hover:text-blue-800 transition-colors text-left">
                                        <i class="fas fa-map-marker-alt mr-1"></i>${pedido.endereco}
                                    </button>
                                    ${pedido.distancia ? `<div class="text-xs text-gray-500 mt-1">
                                        <i class="fas fa-route mr-1"></i>Distância: ${pedido.distancia}
                                    </div>` : ''}
                                </div>
                            </div>
                        </div>
                    ` : pedido.tipo === 'balcao' ? `
                        <div class="border-t pt-4">
                            <div class="space-y-2">
                                <div>
                                    <span class="text-sm font-medium text-gray-900 block mb-1">Tipo de Pedido</span>
                                    <div class="text-sm text-orange-600 font-medium">
                                        <i class="fas fa-store mr-1"></i>Para retirada no balcão
                                    </div>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="border-t pt-4">
                        <div class="flex space-x-3">
                            ${botoes}
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }
        
        function closePedidoModal() {
            document.getElementById('pedido-modal').classList.add('hidden');
        }

        // Funções de ação dos pedidos
        function aceitarPedido(numero) {
            const pedido = pedidosData.novos.find(p => p.id === numero);
            if (pedido) {
                pedidosData.novos = pedidosData.novos.filter(p => p.id !== numero);
                pedidosData.preparo.push(pedido);
                atualizarPainelKDS();
                showNotification(`Pedido ${numero} aceito e enviado para preparo!`, 'success');
            }
            closePedidoModal();
        }

        // Funções da nova aba Pedidos
        function aceitarPedidoAba(numero) {
            const pedido = pedidosAbaData.aguardando.find(p => p.id === numero);
            if (pedido) {
                // Remover de aguardando
                pedidosAbaData.aguardando = pedidosAbaData.aguardando.filter(p => p.id !== numero);
                
                // Adicionar ao KDS (novos pedidos)
                const novoPedidoKDS = {
                    id: pedido.id,
                    cliente: pedido.cliente,
                    telefone: pedido.telefone,
                    total: pedido.total,
                    itens: pedido.itens,
                    tempo: '0min',
                    hora: pedido.hora,
                    tipo: pedido.tipo,
                    endereco: pedido.endereco,
                    distancia: pedido.distancia
                };
                
                pedidosData.novos.push(novoPedidoKDS);
                
                atualizarPainelPedidos();
                atualizarPainelKDS();
                showNotification(`Pedido ${numero} aceito e enviado para produção!`, 'success');
            }
        }

        function designarEntregador(numero) {
            const pedido = pedidosAbaData.prontos.find(p => p.id === numero);
            if (pedido && pedido.tipo === 'delivery') {
                // Remover de prontos
                pedidosAbaData.prontos = pedidosAbaData.prontos.filter(p => p.id !== numero);
                
                // Enviar para aba Entregas
                const entregadores = ['Carlos Moto', 'João Bike', 'Ana Delivery', 'Pedro Express'];
                const entregadorSelecionado = entregadores[Math.floor(Math.random() * entregadores.length)];
                
                const agora = new Date();
                const tempoSaida = `${agora.getHours().toString().padStart(2, '0')}:${agora.getMinutes().toString().padStart(2, '0')}`;
                const previsaoEntrega = `${(agora.getHours() + 1).toString().padStart(2, '0')}:${(agora.getMinutes() + 30).toString().padStart(2, '0')}`;
                
                const pedidoEntrega = {
                    id: pedido.id,
                    cliente: pedido.cliente,
                    telefone: pedido.telefone,
                    total: pedido.total,
                    itens: pedido.itens,
                    endereco: pedido.endereco,
                    distancia: pedido.distancia,
                    entregador: entregadorSelecionado,
                    tempoSaida: tempoSaida,
                    previsaoEntrega: previsaoEntrega,
                    status: 'saindo'
                };
                
                pedidosEntregaData.push(pedidoEntrega);
                
                atualizarPainelPedidos();
                atualizarPainelEntregas();
                showNotification(`Pedido ${numero} despachado para entrega com ${entregadorSelecionado}!`, 'success');
            }
        }

        function entregarPedidoPronto(numero) {
            const pedido = pedidosAbaData.prontos.find(p => p.id === numero);
            if (pedido && pedido.tipo === 'balcao') {
                // Remover de prontos
                pedidosAbaData.prontos = pedidosAbaData.prontos.filter(p => p.id !== numero);
                
                atualizarPainelPedidos();
                showNotification(`Pedido ${numero} entregue ao cliente!`, 'success');
            }
        }

        // Modal da nova aba Pedidos
        function openPedidoAbaModal(numero, status) {
            const modal = document.getElementById('pedido-modal');
            const pedidoNumber = document.getElementById('pedido-number');
            const pedidoContent = document.getElementById('pedido-content');
            
            pedidoNumber.textContent = numero;
            
            // Buscar pedido nos dados da aba
            let pedido = null;
            if (pedidosAbaData.aguardando.find(p => p.id === numero)) {
                pedido = pedidosAbaData.aguardando.find(p => p.id === numero);
            } else if (pedidosAbaData.prontos.find(p => p.id === numero)) {
                pedido = pedidosAbaData.prontos.find(p => p.id === numero);
            }
            
            if (!pedido) return;
            
            let botoes = '';
            if (status === 'aguardando') {
                botoes = `
                    <button onclick="rejeitarPedidoAba('${numero}')" class="w-20 border border-gray-300 text-gray-700 py-2 px-3 rounded text-sm font-medium hover:bg-gray-50 transition-colors">
                        Rejeitar
                    </button>
                    <button onclick="aceitarPedidoAba('${numero}'); closePedidoModal();" class="flex-1 bg-blue-500 text-white py-2 px-4 rounded font-medium hover:bg-blue-600 transition-colors">
                        Aceitar
                    </button>
                `;
            } else if (status === 'prontos') {
                if (pedido.tipo === 'delivery') {
                    botoes = `
                        <button onclick="designarEntregador('${numero}'); closePedidoModal();" class="flex-1 bg-green-500 text-white py-2 px-4 rounded font-medium hover:bg-green-600 transition-colors">
                            Designar
                        </button>
                    `;
                } else {
                    botoes = `
                        <button onclick="entregarPedidoPronto('${numero}'); closePedidoModal();" class="flex-1 bg-orange-500 text-white py-2 px-4 rounded font-medium hover:bg-orange-600 transition-colors">
                            Entregar ao Cliente
                        </button>
                    `;
                }
            }
            
            const telefoneFormatado = pedido.telefone.replace(/\D/g, '');
            
            pedidoContent.innerHTML = `
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-medium text-gray-900">${pedido.cliente}</span>
                            <span class="text-gray-400">•</span>
                            <button onclick="window.open('https://wa.me/55${telefoneFormatado}', '_blank')" class="text-sm text-green-600 hover:text-green-800 transition-colors">
                                ${pedido.telefone}
                            </button>
                        </div>
                        ${pedido.tipo ? `<span class="text-xs px-2 py-1 rounded-full ${pedido.tipo === 'delivery' ? 'bg-blue-100 text-blue-700' : 'bg-orange-100 text-orange-700'}">
                            <i class="fas fa-${pedido.tipo === 'delivery' ? 'motorcycle' : 'store'} mr-1"></i>${pedido.tipo === 'delivery' ? 'Delivery' : 'Balcão'}
                        </span>` : ''}
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="space-y-3">
                            ${pedido.itens.map(item => `
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <div class="text-sm text-gray-900">${item}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-900">Total</span>
                            <span class="text-sm font-bold text-orange-500">R$ ${pedido.total.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600">Forma de Pagamento</span>
                            <span class="text-xs font-medium text-gray-700">
                                ${pedido.tipo === 'delivery' ? 'PIX automático' : 'Cartão'}
                            </span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Status do Pagamento</span>
                            <span class="text-xs font-medium px-2 py-1 rounded bg-green-100 text-green-700">
                                Confirmado
                            </span>
                        </div>
                    </div>
                    
                    ${pedido.endereco && pedido.tipo === 'delivery' ? `
                        <div class="border-t pt-4">
                            <div class="space-y-2">
                                <div>
                                    <span class="text-sm font-medium text-gray-900 block mb-1">Endereço de Entrega</span>
                                    <button onclick="window.open('https://maps.google.com/?q=${encodeURIComponent(pedido.endereco)}', '_blank')" class="text-sm text-blue-600 hover:text-blue-800 transition-colors text-left">
                                        <i class="fas fa-map-marker-alt mr-1"></i>${pedido.endereco}
                                    </button>
                                    ${pedido.distancia ? `<div class="text-xs text-gray-500 mt-1">
                                        <i class="fas fa-route mr-1"></i>Distância: ${pedido.distancia}
                                    </div>` : ''}
                                </div>
                            </div>
                        </div>
                    ` : pedido.tipo === 'balcao' ? `
                        <div class="border-t pt-4">
                            <div class="space-y-2">
                                <div>
                                    <span class="text-sm font-medium text-gray-900 block mb-1">Tipo de Pedido</span>
                                    <div class="text-sm text-orange-600 font-medium">
                                        <i class="fas fa-store mr-1"></i>Para retirada no balcão
                                    </div>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="border-t pt-4">
                        <div class="flex space-x-3">
                            ${botoes}
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function rejeitarPedidoAba(numero) {
            if (confirm(`Tem certeza que deseja rejeitar o pedido ${numero}?`)) {
                pedidosAbaData.aguardando = pedidosAbaData.aguardando.filter(p => p.id !== numero);
                atualizarPainelPedidos();
                showNotification(`Pedido ${numero} rejeitado!`, 'error');
                closePedidoModal();
            }
        }
        
        function rejeitarPedido(numero) {
            if (confirm(`Tem certeza que deseja rejeitar o pedido ${numero}?`)) {
                pedidosData.novos = pedidosData.novos.filter(p => p.id !== numero);
                atualizarPainelKDS();
                showNotification(`Pedido ${numero} rejeitado!`, 'error');
                closePedidoModal();
            }
        }
        
        function finalizarPedido(numero) {
            const pedido = pedidosData.preparo.find(p => p.id === numero);
            if (pedido) {
                // Remover da preparação
                pedidosData.preparo = pedidosData.preparo.filter(p => p.id !== numero);
                
                // Enviar para aba Pedidos (coluna Prontos)
                const pedidoPronto = {
                    id: pedido.id,
                    cliente: pedido.cliente,
                    telefone: pedido.telefone,
                    total: pedido.total,
                    itens: pedido.itens,
                    tempo: '0min',
                    hora: pedido.hora,
                    tipo: pedido.tipo,
                    endereco: pedido.endereco,
                    distancia: pedido.distancia,
                    entregador: null
                };
                
                pedidosAbaData.prontos.push(pedidoPronto);
                
                if (pedido.tipo === 'delivery') {
                    showNotification(`Pedido ${numero} finalizado e pronto para designar entregador!`, 'success');
                } else {
                    showNotification(`Pedido ${numero} finalizado e pronto para retirada!`, 'success');
                }
                
                atualizarPainelKDS();
                atualizarPainelPedidos();
            }
            closePedidoModal();
        }
        

        
        function cancelarPedido(numero) {
            if (confirm(`Tem certeza que deseja cancelar o pedido ${numero}?`)) {
                pedidosData.preparo = pedidosData.preparo.filter(p => p.id !== numero);
                atualizarPainelKDS();
                showNotification(`Pedido ${numero} cancelado!`, 'error');
                closePedidoModal();
            }
        }
        

        
        function voltarNovos(numero) {
            const pedido = pedidosData.preparo.find(p => p.id === numero);
            if (pedido) {
                pedidosData.preparo = pedidosData.preparo.filter(p => p.id !== numero);
                pedidosData.novos.push(pedido);
                atualizarPainelKDS();
                showNotification(`Pedido ${numero} voltou para novos!`, 'warning');
            }
            closePedidoModal();
        }

        function adjustLugares(numero, delta) {
            const mesa = mesasData[numero];
            const novoLugares = Math.max(1, Math.min(12, mesa.lugares + delta));
            mesa.lugares = novoLugares;
            document.getElementById(`lugares-${numero}`).textContent = novoLugares;
            atualizarPainelMesas();
        }

        function ocuparMesa(numero) {
            mesasData[numero].status = 'ocupada';
            mesasData[numero].tempo = '1min';
            mesasData[numero].atendente = 'Garçom Padrão';
            mesasData[numero].taxaGarcom = true;
            mesasData[numero].clientes = [];
            atualizarPainelMesas();
            showNotification(`Mesa ${numero} ocupada!`, 'success');
            closeMesaModal();
        }
        
        function liberarMesa(numero) {
            if (confirm(`Tem certeza que deseja liberar a mesa ${numero}?`)) {
                const lugares = mesasData[numero].lugares;
                mesasData[numero] = { status: 'livre', lugares: lugares };
                atualizarPainelMesas();
                showNotification(`Mesa ${numero} liberada!`, 'success');
                closeMesaModal();
            }
        }
        
        function reservarMesa(numero) {
            mesasData[numero].status = 'reservada';
            mesasData[numero].cliente = 'Cliente Reserva';
            mesasData[numero].pessoas = 2;
            mesasData[numero].horario = '18:00';
            atualizarPainelMesas();
            showNotification(`Mesa ${numero} reservada!`, 'success');
            closeMesaModal();
        }
        
        function confirmarChegada(numero) {
            mesasData[numero].status = 'ocupada';
            mesasData[numero].tempo = '1min';
            mesasData[numero].atendente = 'Garçom Padrão';
            mesasData[numero].taxaGarcom = true;
            mesasData[numero].clientes = [];
            delete mesasData[numero].horario;
            atualizarPainelMesas();
            showNotification(`Chegada confirmada! Mesa ${numero} agora está ocupada.`, 'success');
            closeMesaModal();
        }
        
        function cancelarReserva(numero) {
            if (confirm(`Tem certeza que deseja cancelar a reserva da mesa ${numero}?`)) {
                const lugares = mesasData[numero].lugares;
                mesasData[numero] = { status: 'livre', lugares: lugares };
                atualizarPainelMesas();
                showNotification(`Reserva da mesa ${numero} cancelada!`, 'warning');
                closeMesaModal();
            }
        }

        function trocarAtendente(numero) {
            const atendentes = ['Carlos Silva', 'Ana Costa', 'João Santos', 'Maria Oliveira', 'Pedro Lima'];
            const atendenteAtual = mesasData[numero].atendente;
            const outrosAtendentes = atendentes.filter(a => a !== atendenteAtual);
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl w-full max-w-sm">
                    <div class="flex items-center justify-between p-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900">Trocar Atendente</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-4">
                        <div class="space-y-2">
                            ${outrosAtendentes.map(atendente => `
                                <button onclick="setAtendente(${numero}, '${atendente}'); this.closest('.fixed').remove();" class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded">
                                    ${atendente}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function setAtendente(numero, atendente) {
            mesasData[numero].atendente = atendente;
            atualizarPainelMesas();
            showNotification(`Atendente da mesa ${numero} alterado para ${atendente}!`, 'success');
            openMesaModal(numero, 'ocupada');
        }

        function toggleTaxaGarcom(numero) {
            mesasData[numero].taxaGarcom = !mesasData[numero].taxaGarcom;
            atualizarPainelMesas();
            showNotification(`Taxa do garçom ${mesasData[numero].taxaGarcom ? 'ativada' : 'desativada'} para mesa ${numero}!`, 'success');
            openMesaModal(numero, 'ocupada');
        }

        function toggleTaxaCliente(numeroMesa, clienteId) {
            const cliente = mesasData[numeroMesa].clientes.find(c => c.id === clienteId);
            if (cliente) {
                cliente.taxaServico = cliente.taxaServico === false ? true : false;
                atualizarPainelMesas();
                showNotification(`Taxa de serviço ${cliente.taxaServico !== false ? 'ativada' : 'desativada'} para ${cliente.nome}!`, 'success');
                openMesaModal(numeroMesa, 'ocupada');
            }
        }

        function adicionarCliente(numero) {
            const nome = prompt('Nome do cliente:');
            if (nome && nome.trim()) {
                if (!mesasData[numero].clientes) {
                    mesasData[numero].clientes = [];
                }
                const novoId = Math.max(0, ...mesasData[numero].clientes.map(c => c.id)) + 1;
                mesasData[numero].clientes.push({
                    id: novoId,
                    nome: nome.trim(),
                    pedidos: [],
                    total: 0,
                    pago: false,
                    taxaServico: true
                });
                atualizarPainelMesas();
                showNotification(`Cliente ${nome} adicionado à mesa ${numero}!`, 'success');
                openMesaModal(numero, 'ocupada');
            }
        }

        function editarCliente(numeroMesa, clienteId) {
            const cliente = mesasData[numeroMesa].clientes.find(c => c.id === clienteId);
            if (!cliente) return;
            
            const novoNome = prompt('Novo nome do cliente:', cliente.nome);
            if (novoNome && novoNome.trim()) {
                cliente.nome = novoNome.trim();
                atualizarPainelMesas();
                showNotification(`Nome do cliente alterado!`, 'success');
                openMesaModal(numeroMesa, 'ocupada');
            }
        }

        function marcarComoPago(numeroMesa, clienteId) {
            const cliente = mesasData[numeroMesa].clientes.find(c => c.id === clienteId);
            if (cliente) {
                cliente.pago = true;
                atualizarPainelMesas();
                showNotification(`Pagamento de ${cliente.nome} marcado como pago!`, 'success');
                openMesaModal(numeroMesa, 'ocupada');
            }
        }

        function transferirMesa(numeroOrigem) {
            const mesasDisponiveis = Object.keys(mesasData).filter(n => 
                n != numeroOrigem && (mesasData[n].status === 'livre' || mesasData[n].status === 'ocupada')
            );
            
            if (mesasDisponiveis.length === 0) {
                alert('Não há mesas disponíveis para transferência.');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl w-full max-w-sm">
                    <div class="flex items-center justify-between p-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900">Transferir Mesa ${numeroOrigem}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-4">
                        <div class="space-y-2">
                            ${mesasDisponiveis.map(n => `
                                <button onclick="confirmarTransferencia(${numeroOrigem}, ${n}); this.closest('.fixed').remove();" class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded flex items-center justify-between">
                                    <span>Mesa ${n.toString().padStart(2, '0')}</span>
                                    <span class="text-xs text-gray-500">${mesasData[n].status === 'livre' ? 'Livre' : 'Ocupada'}</span>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function confirmarTransferencia(origem, destino) {
            if (confirm(`Confirma a transferência da Mesa ${origem} para a Mesa ${destino}?`)) {
                const dadosOrigem = { ...mesasData[origem] };
                const lugaresDestino = mesasData[destino].lugares;
                
                // Se mesa destino estiver ocupada, mesclar clientes
                if (mesasData[destino].status === 'ocupada') {
                    if (!mesasData[destino].clientes) mesasData[destino].clientes = [];
                    if (dadosOrigem.clientes) {
                        dadosOrigem.clientes.forEach(cliente => {
                            const novoId = Math.max(0, ...mesasData[destino].clientes.map(c => c.id)) + 1;
                            mesasData[destino].clientes.push({ ...cliente, id: novoId });
                        });
                    }
                } else {
                    // Mesa destino livre, transferir tudo
                    mesasData[destino] = { ...dadosOrigem, lugares: lugaresDestino };
                }
                
                // Liberar mesa origem
                mesasData[origem] = { status: 'livre', lugares: dadosOrigem.lugares };
                
                atualizarPainelMesas();
                showNotification(`Mesa ${origem} transferida para Mesa ${destino}!`, 'success');
                closeMesaModal();
            }
        }



        function editarMesa(numero) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 md:p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between p-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900">Editar Mesa ${numero}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-4 space-y-4">
                        <!-- Tipo de Conta -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Conta</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="radio" name="tipoConta" value="individual" ${mesasData[numero].tipoConta !== 'conjunta' ? 'checked' : ''} class="mr-2">
                                    <span class="text-sm text-gray-700">Individual (cada cliente paga separado)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="tipoConta" value="conjunta" ${mesasData[numero].tipoConta === 'conjunta' ? 'checked' : ''} class="mr-2">
                                    <span class="text-sm text-gray-700">Conjunta (conta única)</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Transferir Atendente -->
                        <div class="border-t border-gray-200 pt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Transferir Atendente</label>
                            <select id="select-atendente-${numero}" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Selecione um atendente...</option>
                                <option value="Carlos Silva" ${mesasData[numero].atendente === 'Carlos Silva' ? 'selected' : ''}>Carlos Silva</option>
                                <option value="Ana Costa" ${mesasData[numero].atendente === 'Ana Costa' ? 'selected' : ''}>Ana Costa</option>
                                <option value="João Santos" ${mesasData[numero].atendente === 'João Santos' ? 'selected' : ''}>João Santos</option>
                                <option value="Maria Oliveira" ${mesasData[numero].atendente === 'Maria Oliveira' ? 'selected' : ''}>Maria Oliveira</option>
                                <option value="Pedro Lima" ${mesasData[numero].atendente === 'Pedro Lima' ? 'selected' : ''}>Pedro Lima</option>
                            </select>
                        </div>
                        
                        <!-- Juntar Mesas -->
                        <div class="border-t border-gray-200 pt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Juntar com Outra Mesa</label>
                            <select id="select-juntar-mesa-${numero}" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Selecione uma mesa...</option>
                                ${Object.keys(mesasData).filter(n => n != numero && (mesasData[n].status === 'livre' || mesasData[n].status === 'ocupada')).map(n => 
                                    `<option value="${n}">Mesa ${n.toString().padStart(2, '0')} (${mesasData[n].status})</option>`
                                ).join('')}
                            </select>
                            <p class="text-xs text-gray-500 mt-1">Os clientes serão unidos na mesa selecionada</p>
                        </div>
                        
                        <!-- Transferir Pedidos -->
                        <div class="border-t border-gray-200 pt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Transferir Pedidos para Outra Mesa</label>
                            <select id="select-transferir-pedidos-${numero}" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Selecione uma mesa...</option>
                                ${Object.keys(mesasData).filter(n => n != numero && (mesasData[n].status === 'livre' || mesasData[n].status === 'ocupada')).map(n => 
                                    `<option value="${n}">Mesa ${n.toString().padStart(2, '0')} (${mesasData[n].status})</option>`
                                ).join('')}
                            </select>
                            <p class="text-xs text-gray-500 mt-1">Apenas os pedidos serão transferidos, clientes permanecem</p>
                        </div>
                        
                        <!-- Botões de Ação -->
                        <div class="border-t border-gray-200 pt-4 flex space-x-3">
                            <button onclick="this.closest('.fixed').remove()" class="w-20 border border-gray-300 text-gray-700 py-2 px-3 rounded text-sm font-medium hover:bg-gray-50">
                                Cancelar
                            </button>
                            <button onclick="salvarEdicaoMesa(${numero}); this.closest('.fixed').remove();" class="flex-1 bg-blue-500 text-white py-2 px-4 rounded font-medium hover:bg-blue-600">
                                Salvar Alterações
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function salvarEdicaoMesa(numero) {
            const mesa = mesasData[numero];
            
            // Salvar tipo de conta
            const tipoConta = document.querySelector('input[name="tipoConta"]:checked')?.value;
            if (tipoConta) {
                mesa.tipoConta = tipoConta;
            }
            
            // Transferir atendente
            const novoAtendente = document.getElementById(`select-atendente-${numero}`)?.value;
            if (novoAtendente && novoAtendente !== mesa.atendente) {
                mesa.atendente = novoAtendente;
                showNotification(`Atendente da Mesa ${numero} alterado para ${novoAtendente}!`, 'success');
            }
            
            // Juntar mesas
            const mesaParaJuntar = document.getElementById(`select-juntar-mesa-${numero}`)?.value;
            if (mesaParaJuntar) {
                juntarMesas(numero, mesaParaJuntar);
                return; // Sai da função pois a mesa foi juntada
            }
            
            // Transferir pedidos
            const mesaParaTransferir = document.getElementById(`select-transferir-pedidos-${numero}`)?.value;
            if (mesaParaTransferir) {
                transferirPedidosMesa(numero, mesaParaTransferir);
            }
            
            atualizarPainelMesas();
            openMesaModal(numero, 'ocupada'); // Reabrir modal atualizado
        }

        function juntarMesas(mesaOrigem, mesaDestino) {
            const dadosOrigem = mesasData[mesaOrigem];
            const dadosDestino = mesasData[mesaDestino];
            
            if (confirm(`Confirma juntar Mesa ${mesaOrigem} com Mesa ${mesaDestino}?\nTodos os clientes serão unidos.`)) {
                // Se mesa destino estiver livre, ocupar
                if (dadosDestino.status === 'livre') {
                    mesasData[mesaDestino] = {
                        ...dadosOrigem,
                        lugares: dadosOrigem.lugares + dadosDestino.lugares
                    };
                } else {
                    // Mesa destino ocupada, mesclar clientes
                    if (!dadosDestino.clientes) dadosDestino.clientes = [];
                    if (dadosOrigem.clientes) {
                        dadosOrigem.clientes.forEach(cliente => {
                            const novoId = Math.max(0, ...dadosDestino.clientes.map(c => c.id)) + 1;
                            dadosDestino.clientes.push({ ...cliente, id: novoId });
                        });
                    }
                    dadosDestino.lugares += dadosOrigem.lugares;
                }
                
                // Liberar mesa origem
                mesasData[mesaOrigem] = { status: 'livre', lugares: dadosOrigem.lugares };
                
                atualizarPainelMesas();
                showNotification(`Mesa ${mesaOrigem} juntada com Mesa ${mesaDestino}!`, 'success');
                closeMesaModal();
            }
        }

        function transferirPedidosMesa(mesaOrigem, mesaDestino) {
            const dadosOrigem = mesasData[mesaOrigem];
            const dadosDestino = mesasData[mesaDestino];
            
            if (!dadosOrigem.clientes || dadosOrigem.clientes.length === 0) {
                showNotification('Não há pedidos para transferir!', 'warning');
                return;
            }
            
            if (confirm(`Confirma transferir todos os pedidos da Mesa ${mesaOrigem} para Mesa ${mesaDestino}?`)) {
                // Se mesa destino estiver livre, ocupar apenas com os pedidos
                if (dadosDestino.status === 'livre') {
                    mesasData[mesaDestino] = {
                        status: 'ocupada',
                        lugares: dadosDestino.lugares,
                        tempo: '1min',
                        atendente: dadosOrigem.atendente || 'Garçom Padrão',
                        taxaGarcom: dadosOrigem.taxaGarcom || true,
                        clientes: dadosOrigem.clientes.map(cliente => ({ ...cliente }))
                    };
                } else {
                    // Mesa destino ocupada, adicionar pedidos aos clientes existentes
                    if (!dadosDestino.clientes) dadosDestino.clientes = [];
                    dadosOrigem.clientes.forEach(cliente => {
                        const novoId = Math.max(0, ...dadosDestino.clientes.map(c => c.id)) + 1;
                        dadosDestino.clientes.push({ ...cliente, id: novoId });
                    });
                }
                
                // Limpar pedidos da mesa origem (manter clientes sem pedidos)
                dadosOrigem.clientes.forEach(cliente => {
                    cliente.pedidos = [];
                    cliente.total = 0;
                    cliente.pago = false;
                });
                
                atualizarPainelMesas();
                showNotification(`Pedidos transferidos da Mesa ${mesaOrigem} para Mesa ${mesaDestino}!`, 'success');
            }
        }

        function finalizarAtendimento(numero) {
            const mesa = mesasData[numero];
            const totalMesa = mesa.clientes ? mesa.clientes.reduce((sum, cliente) => sum + cliente.total, 0) : 0;
            const totalComTaxa = mesa.taxaGarcom ? totalMesa * 1.1 : totalMesa;
            
            if (confirm(`Finalizar atendimento da Mesa ${numero}?\nTotal: R$ ${totalComTaxa.toFixed(2)}`)) {
                const lugares = mesa.lugares;
                mesasData[numero] = { status: 'livre', lugares: lugares };
                atualizarPainelMesas();
                showNotification(`Atendimento da Mesa ${numero} finalizado! Total: R$ ${totalComTaxa.toFixed(2)}`, 'success');
                closeMesaModal();
            }
        }

        function togglePagamentoMenu(numeroMesa, clienteId) {
            const menu = document.getElementById(`menu-pagamento-${numeroMesa}-${clienteId}`);
            const allMenus = document.querySelectorAll('[id^="menu-pagamento-"]');
            
            // Fechar todos os outros menus
            allMenus.forEach(m => {
                if (m.id !== `menu-pagamento-${numeroMesa}-${clienteId}`) {
                    m.classList.add('hidden');
                }
            });
            
            // Toggle do menu atual
            menu.classList.toggle('hidden');
        }

        function processarPagamento(numeroMesa, clienteId, formaPagamento) {
            const cliente = mesasData[numeroMesa].clientes.find(c => c.id === clienteId);
            if (cliente) {
                cliente.pago = true;
                cliente.formaPagamento = formaPagamento;
                
                const formasPagamento = {
                    'pix': 'PIX',
                    'dinheiro': 'Dinheiro',
                    'cartao': 'Cartão',
                    'online': 'Pagamento Online'
                };
                
                atualizarPainelMesas();
                showNotification(`Pagamento de ${cliente.nome} processado via ${formasPagamento[formaPagamento]}!`, 'success');
                
                // Fechar menu de pagamento
                const menu = document.getElementById(`menu-pagamento-${numeroMesa}-${clienteId}`);
                if (menu) menu.classList.add('hidden');
                
                // Reabrir modal para atualizar
                openMesaModal(numeroMesa, 'ocupada');
            }
        }

        // Fechar menus de pagamento ao clicar fora
        document.addEventListener('click', function(event) {
            if (!event.target.closest('[id^="btn-pagar-"]') && !event.target.closest('[id^="menu-pagamento-"]')) {
                document.querySelectorAll('[id^="menu-pagamento-"]').forEach(menu => {
                    menu.classList.add('hidden');
                });
            }
        });



        // Sistema de notificações
        function showNotification(message, type = 'info') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-amber-500',
                info: 'bg-blue-500'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300`;
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : type === 'warning' ? 'exclamation' : 'info'}-circle"></i>
                    <span class="text-sm font-medium">${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Variáveis globais do PDV
        let cart = [];
        let destinoVenda = 'balcao';
        let formaPagamento = null;

        // Base de dados dos produtos
        const produtos = [
            { id: 'hamburguer', nome: 'Hambúrguer Artesanal', categoria: 'lanches', preco: 22.90, icone: 'hamburger' },
            { id: 'pizza', nome: 'Pizza Margherita', categoria: 'lanches', preco: 28.00, icone: 'pizza-slice' },
            { id: 'sanduiche', nome: 'Sanduíche Natural', categoria: 'lanches', preco: 12.90, icone: 'bread-slice' },
            { id: 'cerveja', nome: 'Cerveja', categoria: 'bebidas', preco: 6.00, icone: 'beer' },
            { id: 'refrigerante', nome: 'Refrigerante', categoria: 'bebidas', preco: 4.50, icone: 'glass-whiskey' },
            { id: 'suco', nome: 'Suco Natural', categoria: 'bebidas', preco: 8.00, icone: 'glass-water' },
            { id: 'batata', nome: 'Batata Frita', categoria: 'porcoes', preco: 12.50, icone: 'french-fries' },
            { id: 'frango', nome: 'Porção de Frango', categoria: 'porcoes', preco: 18.90, icone: 'drumstick-bite' },
            { id: 'pudim', nome: 'Pudim de Leite', categoria: 'sobremesas', preco: 8.90, icone: 'birthday-cake' },
            { id: 'sorvete', nome: 'Sorvete', categoria: 'sobremesas', preco: 6.50, icone: 'ice-cream' }
        ];

        // Funções do PDV
        function openPDVModal() {
            document.getElementById('pdv-modal').classList.remove('hidden');
            renderProdutos();
            resetPDV();
        }
        
        function closePDVModal() {
            document.getElementById('pdv-modal').classList.add('hidden');
        }
        
        function resetPDV() {
            cart = [];
            destinoVenda = 'balcao';
            formaPagamento = null;
            updateCartDisplay();
            setDestinoVenda('balcao');
            resetFormaPagamento();
        }
        
        function renderProdutos() {
            const grid = document.getElementById('produtos-grid');
            const gridMobile = document.getElementById('produtos-grid-mobile');
            const html = produtos.map(produto => `
                <div onclick="addProdutoToCart('${produto.id}', '${produto.nome}', ${produto.preco})" class="produto-item bg-white border border-gray-200 rounded-lg p-4 cursor-pointer hover:border-gray-300 hover:shadow-sm transition-all duration-200" data-categoria="${produto.categoria}">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-${produto.icone} text-gray-600 text-lg"></i>
                        </div>
                        <h4 class="text-sm font-medium text-gray-900 mb-1">${produto.nome}</h4>
                        <div class="text-sm font-semibold text-gray-900">R$ ${produto.preco.toFixed(2)}</div>
                    </div>
                </div>
            `).join('');
            
            if (grid) grid.innerHTML = html;
            if (gridMobile) gridMobile.innerHTML = html;
        }
        
        function filterCategory(categoria) {
            document.querySelectorAll('.category-filter').forEach(btn => {
                btn.classList.remove('active', 'bg-orange-100', 'text-orange-700');
                btn.classList.add('text-gray-600');
            });
            
            event.target.classList.add('active', 'bg-orange-100', 'text-orange-700');
            
            document.querySelectorAll('.produto-item').forEach(item => {
                const itemCategoria = item.getAttribute('data-categoria');
                item.style.display = (categoria === 'todos' || itemCategoria === categoria) ? 'block' : 'none';
            });
        }
        
        function setDestinoVenda(destino) {
            destinoVenda = destino;
            
            document.querySelectorAll('.destino-toggle').forEach(btn => {
                btn.classList.remove('bg-white', 'text-gray-900', 'shadow-sm');
                btn.classList.add('text-gray-500');
            });
            
            document.getElementById(`destino-${destino}`).classList.add('bg-white', 'text-gray-900', 'shadow-sm');
            
            const destinoEspecifico = document.getElementById('destino-especifico');
            const selectDestino = document.getElementById('select-destino');
            
            if (destino === 'balcao') {
                destinoEspecifico.classList.add('hidden');
            } else {
                destinoEspecifico.classList.remove('hidden');
                selectDestino.innerHTML = '<option value="">Selecione...</option>';
                
                if (destino === 'mesa') {
                    for (let i = 1; i <= 8; i++) {
                        selectDestino.innerHTML += `<option value="mesa-${i}">Mesa ${i.toString().padStart(2, '0')}</option>`;
                    }
                } else if (destino === 'comanda') {
                    ['C001', 'C002', 'C004'].forEach(comanda => {
                        selectDestino.innerHTML += `<option value="${comanda}">Comanda ${comanda}</option>`;
                    });
                } else if (destino === 'delivery') {
                    selectDestino.innerHTML += '<option value="novo-delivery">Novo Pedido Delivery</option>';
                }
            }
            
            updateFinalizarButton();
        }
        
        function addProdutoToCart(id, nome, preco) {
            const existingItem = cart.find(item => item.id === id);
            
            if (existingItem) {
                existingItem.quantidade++;
            } else {
                cart.push({ id, nome, preco, quantidade: 1 });
            }
            
            updateCartDisplay();
            updateFinalizarButton();
        }
        
        function removeFromCart(id) {
            cart = cart.filter(item => item.id !== id);
            updateCartDisplay();
            updateFinalizarButton();
        }
        
        function updateQuantity(id, delta) {
            const item = cart.find(item => item.id === id);
            if (item) {
                item.quantidade += delta;
                if (item.quantidade <= 0) {
                    removeFromCart(id);
                } else {
                    updateCartDisplay();
                    updateFinalizarButton();
                }
            }
        }
        
        function clearCart() {
            if (cart.length > 0 && confirm('Tem certeza que deseja limpar o carrinho?')) {
                cart = [];
                updateCartDisplay();
                updateFinalizarButton();
            }
        }
        
        function updateCartDisplay() {
            const containers = ['cart-items', 'cart-items-mobile'];
            const subtotalElements = ['cart-subtotal', 'cart-subtotal-mobile'];
            const taxaElements = ['cart-taxa', 'cart-taxa-mobile'];
            const totalElements = ['cart-total', 'cart-total-mobile'];
            
            if (cart.length === 0) {
                const emptyHtml = `
                    <div class="text-center py-8 text-gray-400">
                        <i class="fas fa-shopping-cart text-2xl mb-2"></i>
                        <p class="text-sm">Nenhum item selecionado</p>
                    </div>
                `;
                containers.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.innerHTML = emptyHtml;
                });
                
                subtotalElements.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = 'R$ 0,00';
                });
                
                taxaElements.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = 'R$ 0,00';
                });
                
                totalElements.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = 'R$ 0,00';
                });
                return;
            }
            
            let subtotal = 0;
            let itemsHtml = '';
            
            cart.forEach(item => {
                const itemTotal = item.preco * item.quantidade;
                subtotal += itemTotal;
                
                itemsHtml += `
                    <div class="bg-white border border-gray-200 rounded-lg p-3">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex-1">
                                <h5 class="text-sm font-medium text-gray-900">${item.nome}</h5>
                                <p class="text-xs text-gray-500">R$ ${item.preco.toFixed(2)} cada</p>
                            </div>
                            <button onclick="removeFromCart('${item.id}')" class="text-red-500 hover:text-red-700 p-1">
                                <i class="fas fa-trash text-xs"></i>
                            </button>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <button onclick="updateQuantity('${item.id}', -1)" class="w-6 h-6 bg-gray-100 rounded text-xs hover:bg-gray-200 transition-colors">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span class="text-sm font-medium w-8 text-center">${item.quantidade}</span>
                                <button onclick="updateQuantity('${item.id}', 1)" class="w-6 h-6 bg-gray-100 rounded text-xs hover:bg-gray-200 transition-colors">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <span class="text-sm font-bold text-gray-900">R$ ${itemTotal.toFixed(2)}</span>
                        </div>
                    </div>
                `;
            });
            
            const taxa = subtotal * 0.1;
            const total = subtotal + taxa;
            
            containers.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.innerHTML = itemsHtml;
            });
            
            subtotalElements.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.textContent = `R$ ${subtotal.toFixed(2)}`;
            });
            
            taxaElements.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.textContent = `R$ ${taxa.toFixed(2)}`;
            });
            
            totalElements.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.textContent = `R$ ${total.toFixed(2)}`;
            });
        }
        
        function updateFinalizarButton() {
            const btnFinalizar = document.getElementById('btn-finalizar-venda');
            const selectDestino = document.getElementById('select-destino');
            
            const hasItems = cart.length > 0;
            const hasDestino = destinoVenda === 'balcao' || selectDestino.value !== '';
            const hasPagamento = formaPagamento !== null;
            
            btnFinalizar.disabled = !(hasItems && hasDestino && hasPagamento);
        }
        
        function setFormaPagamento(forma) {
            formaPagamento = forma;
            
            document.querySelectorAll('.pagamento-toggle').forEach(btn => {
                btn.classList.remove('bg-green-100', 'text-green-700', 'border-green-300');
                btn.classList.add('border-gray-300', 'text-gray-700');
            });
            
            document.getElementById(`pagamento-${forma}`).classList.add('bg-green-100', 'text-green-700', 'border-green-300');
            
            updateFinalizarButton();
        }
        
        function resetFormaPagamento() {
            formaPagamento = null;
            document.querySelectorAll('.pagamento-toggle').forEach(btn => {
                btn.classList.remove('bg-green-100', 'text-green-700', 'border-green-300');
                btn.classList.add('border-gray-300', 'text-gray-700');
            });
        }
        
        function finalizarVenda() {
            if (cart.length === 0 || !formaPagamento) return;
            
            const subtotal = cart.reduce((sum, item) => sum + (item.preco * item.quantidade), 0);
            const total = subtotal * 1.1;
            
            // Gerar ID baseado no destino
            let novoId = '';
            if (destinoVenda === 'balcao') {
                novoId = gerarIdPedido('balcao');
            } else if (destinoVenda === 'mesa') {
                novoId = gerarIdPedido('mesa');
            } else if (destinoVenda === 'comanda') {
                novoId = gerarIdPedido('comanda');
            } else if (destinoVenda === 'delivery') {
                novoId = gerarIdPedido('delivery');
            }
            
            alert(`✅ Venda finalizada com sucesso!\n🆔 Pedido: ${novoId}\n💰 Total: R$ ${total.toFixed(2)}`);
            closePDVModal();
        }
        
        // Funções de comandas
        function openComandaAvulsaModal(comanda, status) {
            const comandaData = comandasData[comanda];
            if (!comandaData) return;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 p-2 md:p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl w-full max-w-lg max-h-[90vh] md:max-h-[85vh] flex flex-col mx-2 md:mx-0">
                    <div class="flex items-center justify-between p-3 md:p-4 border-b border-gray-100 flex-shrink-0">
                        <div class="flex items-center space-x-2">
                            <h3 class="text-base md:text-lg font-semibold text-gray-900">Comanda ${comanda}</h3>
                            <span class="text-xs font-medium px-2 py-1 rounded ${status === 'ativa' ? 'bg-blue-100 text-blue-700' : 'bg-amber-100 text-amber-700'}">
                                ${status === 'ativa' ? 'Ativa' : 'Pendente'}
                            </span>
                        </div>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 transition-colors p-1">
                            <i class="fas fa-times text-lg"></i>
                        </button>
                    </div>
                    
                    <div class="flex-1 overflow-y-auto p-3 md:p-4">
                        <div class="space-y-4">
                            <div>
                                <div class="text-sm text-gray-600 mb-2">Cliente</div>
                                <div class="text-sm font-medium text-gray-900">${comandaData.cliente}</div>
                            </div>
                            
                            <div class="border-t pt-4">
                                <div class="text-sm text-gray-600 mb-2">Tempo de Mesa</div>
                                <div class="text-sm text-gray-700">${comandaData.tempo}</div>
                            </div>
                            
                            <div class="border-t pt-4">
                                <div class="text-sm text-gray-600 mb-2">Itens</div>
                                <div class="text-sm text-gray-700">${comandaData.itens} ${comandaData.itens === 1 ? 'item' : 'itens'} consumidos</div>
                            </div>
                            
                            <div class="border-t pt-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-gray-900">Total da Comanda</span>
                                    <span class="text-sm font-bold text-orange-500">R$ ${comandaData.total.toFixed(2)}</span>
                                </div>
                            </div>
                            
                            <div class="border-t pt-4">
                                <div class="flex space-x-3">
                                    ${status === 'ativa' ? `
                                        <button onclick="fecharComanda('${comanda}'); this.closest('.fixed').remove();" class="flex-1 bg-green-500 text-white py-2 px-4 rounded font-medium hover:bg-green-600 transition-colors">
                                            <i class="fas fa-check mr-2"></i>Fechar Comanda
                                        </button>
                                    ` : `
                                        <button onclick="receberPagamento('${comanda}'); this.closest('.fixed').remove();" class="flex-1 bg-blue-500 text-white py-2 px-4 rounded font-medium hover:bg-blue-600 transition-colors">
                                            <i class="fas fa-credit-card mr-2"></i>Receber Pagamento
                                        </button>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function novaComandaAvulsa() {
            const novoId = gerarIdPedido('comanda');
            comandasData[novoId] = {
                cliente: 'Cliente Avulso',
                total: 0,
                tempo: '0min',
                status: 'ativa',
                itens: 0
            };
            atualizarPainelComandas();
            showNotification(`Nova comanda ${novoId} criada!`, 'success');
        }

        function fecharComanda(comanda) {
            delete comandasData[comanda];
            atualizarPainelComandas();
            showNotification(`Comanda ${comanda} fechada!`, 'success');
        }

        function receberPagamento(comanda) {
            delete comandasData[comanda];
            atualizarPainelComandas();
            showNotification(`Pagamento da comanda ${comanda} recebido!`, 'success');
        }

        function verComanda(comanda) {
            openComandaAvulsaModal(comanda, comandasData[comanda]?.status || 'ativa');
        }

        // Event listeners e inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar painéis dinâmicos
            atualizarPainelKDS();
            atualizarPainelPedidos();
            atualizarPainelEntregas();
            atualizarPainelMesas();
            atualizarPainelComandas();
            
            // Event listeners do PDV
            const selectDestino = document.getElementById('select-destino');
            if (selectDestino) {
                selectDestino.addEventListener('change', updateFinalizarButton);
            }
            
            // Atualização automática a cada 30 segundos
            setInterval(() => {
                // Simular mudanças nos tempos dos pedidos do KDS
                ['novos', 'preparo'].forEach(status => {
                    if (pedidosData[status]) {
                        pedidosData[status].forEach(pedido => {
                            const tempoAtual = parseInt(pedido.tempo);
                            if (!isNaN(tempoAtual)) {
                                pedido.tempo = `${tempoAtual + 1}min`;
                            }
                        });
                    }
                });

                // Simular mudanças nos tempos dos pedidos da aba Pedidos
                ['aguardando', 'prontos'].forEach(status => {
                    if (pedidosAbaData[status]) {
                        pedidosAbaData[status].forEach(pedido => {
                            const tempoAtual = parseInt(pedido.tempo);
                            if (!isNaN(tempoAtual)) {
                                pedido.tempo = `${tempoAtual + 1}min`;
                            }
                        });
                    }
                });
                
                // Atualizar tempos das mesas ocupadas
                Object.keys(mesasData).forEach(numero => {
                    const mesa = mesasData[numero];
                    if (mesa.status === 'ocupada' && mesa.tempo) {
                        const match = mesa.tempo.match(/(\d+)min/);
                        if (match) {
                            mesa.tempo = `${parseInt(match[1]) + 1}min`;
                        }
                    }
                });
                
                // Atualizar tempos das comandas
                Object.keys(comandasData).forEach(id => {
                    const comanda = comandasData[id];
                    if (comanda.status === 'ativa' && comanda.tempo !== 'Aguardando') {
                        const match = comanda.tempo.match(/(\d+)min/);
                        if (match) {
                            comanda.tempo = `${parseInt(match[1]) + 1}min`;
                        }
                    }
                });
                
                // Atualizar painéis
                atualizarPainelKDS();
                atualizarPainelPedidos();
                atualizarPainelEntregas();
                atualizarPainelMesas();
                atualizarPainelComandas();
            }, 30000);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9808ef79c15ee128',t:'MTc1ODExNTU4OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
